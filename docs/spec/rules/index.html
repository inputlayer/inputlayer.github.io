<!DOCTYPE html><!--05bjYGyiAumoEMBrfWHih--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/4cf2300e9c8272f7-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/4bd7a24b7976d4e6.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-bd6546b43ab2ecbf.js"/><script src="/_next/static/chunks/4bd1b696-deba172d32c79f82.js" async=""></script><script src="/_next/static/chunks/794-275dc9ebd3a29fbf.js" async=""></script><script src="/_next/static/chunks/main-app-1fa5b694e5d36a75.js" async=""></script><script src="/_next/static/chunks/app/layout-7e9963bf811be36b.js" async=""></script><script src="/_next/static/chunks/758-3cb69ce377cde046.js" async=""></script><script src="/_next/static/chunks/121-aece4f809b101dc1.js" async=""></script><script src="/_next/static/chunks/502-e809071f8789437b.js" async=""></script><script src="/_next/static/chunks/689-4fcf9680fdc90283.js" async=""></script><script src="/_next/static/chunks/app/docs/%5B%5B...slug%5D%5D/page-004ec69e3c86920a.js" async=""></script><meta name="next-size-adjust" content=""/><title>InputLayer - A symbolic reasoning engine for AI agents</title><meta name="description" content="Store facts, define rules, and derive everything that logically follows. Vector search, graph traversal, and incremental computation in one system."/><link rel="icon" href="/icon.svg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_188709 __variable_9a8899 font-sans antialiased"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","dark",null,["light","dark"],null,true,true)</script><div class="flex flex-col h-dvh"><header class="sticky top-0 z-50 w-full border-b border-border/50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"><div class="flex h-14 items-center px-6"><a class="mr-8" href="/"><span class="inline-flex items-center gap-1.5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg><span class="font-extrabold tracking-tight text-lg">InputLayer</span></span></a><nav class="hidden md:flex items-center gap-6 text-sm"><a class="text-muted-foreground transition-colors hover:text-foreground" href="/docs/">Docs</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/blog/">Blog</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/use-cases/">Use Cases</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/compare/">Compare</a><a href="https://demo.inputlayer.ai" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 text-muted-foreground transition-colors hover:text-foreground">Demo<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link h-3 w-3"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg></a></nav><div class="ml-auto flex items-center gap-3"><div class="inline-flex items-center gap-1.5"><a href="https://github.com/inputlayer/inputlayer" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 rounded-md border border-border bg-secondary/50 px-2.5 py-1 text-xs font-medium text-muted-foreground transition-colors hover:text-foreground hover:bg-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star h-3.5 w-3.5"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"></path></svg><span>Star</span></a><a href="https://github.com/inputlayer/inputlayer/fork" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 rounded-md border border-border bg-secondary/50 px-2.5 py-1 text-xs font-medium text-muted-foreground transition-colors hover:text-foreground hover:bg-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-git-fork h-3.5 w-3.5"><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path><path d="M12 12v3"></path></svg><span>Fork</span></a></div><button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 size-9 h-9 w-9"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun h-4 w-4"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg></button><div class="md:hidden"><button class="inline-flex items-center justify-center rounded-md p-2 text-muted-foreground hover:text-foreground hover:bg-secondary transition-colors" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-5 w-5"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button></div></div></div></header><div class="flex flex-1 overflow-hidden"><div class="w-64 shrink-0 border-r border-border/50 overflow-y-auto"><div class="flex flex-col h-full"><div class="p-3 border-b border-border/50"><div class="relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><input type="text" placeholder="Search docs..." class="w-full h-8 pl-8 pr-3 text-sm rounded-md border border-border bg-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring" value=""/></div></div><nav class="flex-1 overflow-y-auto p-2 space-y-0.5"><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" href="/docs/index/">Overview</a><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_j6av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Guides</button><div data-state="closed" id="radix-_R_j6av5ubtb_" hidden="" data-slot="collapsible-content"></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_r6av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Reference</button><div data-state="closed" id="radix-_R_r6av5ubtb_" hidden="" data-slot="collapsible-content"></div></div><div data-state="open" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-foreground font-medium" style="padding-left:12px" type="button" aria-controls="radix-_R_136av5ubtb_" aria-expanded="true" data-state="open" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform rotate-90"><path d="m9 18 6-6-6-6"></path></svg>Specification</button><div data-state="open" id="radix-_R_136av5ubtb_" data-slot="collapsible-content"><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/spec/index/">Overview</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/spec/basic-concepts/">Basic Concepts</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/spec/types/">Types</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors bg-primary/10 text-primary font-medium" style="padding-left:24px" href="/docs/spec/rules/">Rules</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/spec/queries/">Queries</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/spec/grammar/">Grammar</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/spec/errors/">Errors</a></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_1b6av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Internals</button><div data-state="closed" id="radix-_R_1b6av5ubtb_" hidden="" data-slot="collapsible-content"></div></div></nav></div></div><div class="flex flex-1 flex-col overflow-hidden"><div class="flex flex-1 overflow-hidden"><div class="flex-1 overflow-y-auto px-8 py-6 max-w-4xl mx-auto"><article class="docs-prose"><h1 id="rules" node="[object Object]">Rules</h1>
<p>Rules define derived relations (views) by computing new facts from existing data. InputLayer has two types of rules:</p>
<div class="my-4 overflow-x-auto"><table class="w-full border-collapse" node="[object Object]"><thead><tr><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Type</th><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Syntax</th><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Persistence</th></tr></thead><tbody><tr><td class="border px-4 py-2" node="[object Object]"><strong>Session rule</strong></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">head &lt;- body</code></td><td class="border px-4 py-2" node="[object Object]">Temporary, cleared on disconnect</td></tr><tr><td class="border px-4 py-2" node="[object Object]"><strong>Persistent rule</strong></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">+head &lt;- body</code></td><td class="border px-4 py-2" node="[object Object]">Saved to disk, survives restarts</td></tr></tbody></table></div>
<h2 id="session-rules" node="[object Object]">Session Rules</h2>
<p>Session rules exist only for your current connection:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Define a session rule</span>
<span class="syn-identifier">ancestor</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">parent</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span>
<span class="syn-identifier">ancestor</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">ancestor</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">parent</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span>

<span class="syn-comment">// Use it immediately</span>
<span class="syn-query">?</span><span class="syn-identifier">ancestor</span><span class="syn-punct">(</span><span class="syn-string">"alice"</span><span class="syn-punct">,</span> <span class="syn-variable">X</span><span class="syn-punct">)</span>

<span class="syn-comment">// Rule is gone when you disconnect</span>
</code></pre>
<p>Session rules are useful for:</p>
<ul>
<li>Ad-hoc analysis</li>
<li>Experimenting with rule definitions</li>
<li>One-time computations</li>
</ul>
<h3 id="managing-session-rules" node="[object Object]">Managing Session Rules</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">.session              // List all session rules
.session clear        // Clear all session rules
.session drop 1       // Drop session rule #1
</code></pre>
<h2 id="persistent-rules" node="[object Object]">Persistent Rules</h2>
<p>Persistent rules are saved to disk and automatically loaded:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Create a persistent rule (saved)</span>
<span class="syn-arith">+</span><span class="syn-identifier">path</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span>
<span class="syn-arith">+</span><span class="syn-identifier">path</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">path</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span>

<span class="syn-comment">// Works immediately and after restart</span>
<span class="syn-query">?</span><span class="syn-identifier">path</span><span class="syn-punct">(</span><span class="syn-number">1</span><span class="syn-punct">,</span> <span class="syn-variable">X</span><span class="syn-punct">)</span>
</code></pre>
<p>Persistent rules are stored in <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">{data_dir}/{kg}/rules/catalog.json</code>.</p>
<h3 id="multi-clause-rules" node="[object Object]">Multi-Clause Rules</h3>
<p>A view can be defined by multiple rules (clauses):</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// First clause: base case</span>
<span class="syn-arith">+</span><span class="syn-identifier">ancestor</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">parent</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span>

<span class="syn-comment">// Second clause: recursive case</span>
<span class="syn-arith">+</span><span class="syn-identifier">ancestor</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">parent</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">ancestor</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span>
</code></pre>
<p>Both clauses define <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">ancestor</code>. Results are the union of all matching clauses.</p>
<h3 id="deleting-persistent-rules" node="[object Object]">Deleting Persistent Rules</h3>
<p>Remove a persistent rule with <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">-</code>:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">-</span><span class="syn-identifier">path</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span>    <span class="syn-comment">// Removes all rules defining 'path'</span>
</code></pre>
<p>Or use meta commands:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">.rule drop path        // Drop &#x27;path&#x27; rule
.rule clear path       // Clear for re-registration
</code></pre>
<h2 id="rule-structure" node="[object Object]">Rule Structure</h2>
<p>A rule has two parts:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">head(Variables) &lt;- body
     ^              ^
  What to         What must
  produce         be true
</code></pre>
<h3 id="head" node="[object Object]">Head</h3>
<p>The head is an atom that defines what the rule produces:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">path</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span>
<span class="syn-comment">// ^^^^^^^^</span>
<span class="syn-comment">// Head: produces facts for 'path' relation</span>
</code></pre>
<p>The head must use a <strong>lowercase</strong> predicate name.</p>
<h3 id="body" node="[object Object]">Body</h3>
<p>The body specifies conditions using literals separated by commas (AND):</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">employee_in_dept</span><span class="syn-punct">(</span><span class="syn-variable">Name</span><span class="syn-punct">,</span> <span class="syn-variable">Dept</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">employee</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Name</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">works_in</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Dept</span><span class="syn-punct">)</span>
<span class="syn-comment">//                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="syn-comment">//                                Body: both conditions must match</span>
</code></pre>
<h2 id="grammar" node="[object Object]">Grammar</h2>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-ebnf text-sm">session_rule    <span class="syn-operator">::=</span> head <span class="syn-string">"&lt;-"</span> body <span class="syn-operator">;</span>
persistent_rule <span class="syn-operator">::=</span> <span class="syn-string">"+"</span> head <span class="syn-string">"&lt;-"</span> body <span class="syn-operator">;</span>
delete_rule     <span class="syn-operator">::=</span> <span class="syn-string">"-"</span> predicate <span class="syn-string">"("</span> variables <span class="syn-string">")"</span> <span class="syn-operator">;</span>
head            <span class="syn-operator">::=</span> predicate <span class="syn-string">"("</span> term <span class="syn-punct">(</span><span class="syn-string">","</span> term<span class="syn-punct">)</span>* <span class="syn-string">")"</span> <span class="syn-operator">;</span>
body            <span class="syn-operator">::=</span> literal <span class="syn-punct">(</span><span class="syn-string">","</span> literal<span class="syn-punct">)</span>* <span class="syn-operator">;</span></code></pre>
<h2 id="body-literals" node="[object Object]">Body Literals</h2>
<p>The body can contain:</p>
<div class="my-4 overflow-x-auto"><table class="w-full border-collapse" node="[object Object]"><thead><tr><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Literal</th><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Example</th><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Meaning</th></tr></thead><tbody><tr><td class="border px-4 py-2" node="[object Object]">Positive atom</td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">edge(X, Y)</code></td><td class="border px-4 py-2" node="[object Object]">Relation must have matching fact</td></tr><tr><td class="border px-4 py-2" node="[object Object]">Negated atom</td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">!edge(X, Y)</code></td><td class="border px-4 py-2" node="[object Object]">Relation must NOT have matching fact</td></tr><tr><td class="border px-4 py-2" node="[object Object]">Comparison</td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">X &gt; 10</code></td><td class="border px-4 py-2" node="[object Object]">Condition must be true</td></tr><tr><td class="border px-4 py-2" node="[object Object]">Arithmetic</td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">Z = X + Y</code></td><td class="border px-4 py-2" node="[object Object]">Compute and bind value</td></tr><tr><td class="border px-4 py-2" node="[object Object]">Aggregation</td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">count&lt;X&gt;</code></td><td class="border px-4 py-2" node="[object Object]">Aggregate over variable</td></tr></tbody></table></div>
<h2 id="recursion" node="[object Object]">Recursion</h2>
<p>Rules can reference themselves (recursion):</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Transitive closure - find all reachable nodes</span>
<span class="syn-arith">+</span><span class="syn-identifier">reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span>
<span class="syn-arith">+</span><span class="syn-identifier">reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span>
</code></pre>
<p>InputLayer handles recursion automatically. It keeps computing until no new facts are found (fixpoint).</p>
<h3 id="mutual-recursion" node="[object Object]">Mutual Recursion</h3>
<p>Rules can reference each other:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">even</span><span class="syn-punct">(</span><span class="syn-number">0</span><span class="syn-punct">)</span>
<span class="syn-arith">+</span><span class="syn-identifier">odd</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">even</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">succ</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">,</span> <span class="syn-variable">X</span><span class="syn-punct">)</span>
<span class="syn-arith">+</span><span class="syn-identifier">even</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">odd</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">succ</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">,</span> <span class="syn-variable">X</span><span class="syn-punct">)</span>
</code></pre>
<h2 id="variable-safety-rules" node="[object Object]">Variable Safety Rules</h2>
<p>All variables in the <strong>head</strong> must appear in a <strong>positive</strong> body literal:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// GOOD: X appears in edge(X, Y)</span>
<span class="syn-arith">+</span><span class="syn-identifier">start_nodes</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span>

<span class="syn-comment">// BAD: X only in head, not in positive body literal</span>
<span class="syn-arith">+</span><span class="syn-identifier">broken</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">A</span><span class="syn-punct">,</span> <span class="syn-variable">B</span><span class="syn-punct">)</span>   <span class="syn-comment">// ERROR: X is unbound</span>
</code></pre>
<p>Variables in <strong>negations</strong> or <strong>comparisons</strong> must also appear in a positive literal:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// GOOD: X is bound by edge, then filtered</span>
<span class="syn-arith">+</span><span class="syn-identifier">filtered</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-variable">X</span> <span class="syn-comparison">&gt;</span> <span class="syn-number">5</span>

<span class="syn-comment">// BAD: X only in comparison</span>
<span class="syn-arith">+</span><span class="syn-identifier">broken</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-variable">Y</span> <span class="syn-comparison">&gt;</span> <span class="syn-number">5</span>   <span class="syn-comment">// ERROR: X unbound, Y only in comparison</span>
</code></pre>
<h2 id="common-patterns" node="[object Object]">Common Patterns</h2>
<h3 id="filter" node="[object Object]">Filter</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">adults</span><span class="syn-punct">(</span><span class="syn-variable">Name</span><span class="syn-punct">,</span> <span class="syn-variable">Age</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">person</span><span class="syn-punct">(</span><span class="syn-variable">Name</span><span class="syn-punct">,</span> <span class="syn-variable">Age</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-variable">Age</span> <span class="syn-comparison">&gt;=</span> <span class="syn-number">18</span>
</code></pre>
<h3 id="join" node="[object Object]">Join</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">employee_dept</span><span class="syn-punct">(</span><span class="syn-variable">Name</span><span class="syn-punct">,</span> <span class="syn-variable">DeptName</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">employee</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Name</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">works_in</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">DeptId</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">department</span><span class="syn-punct">(</span><span class="syn-variable">DeptId</span><span class="syn-punct">,</span> <span class="syn-variable">DeptName</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="set-difference" node="[object Object]">Set Difference</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">not_in_b</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">a</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-negation">!</span><span class="syn-body-id">b</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="aggregation" node="[object Object]">Aggregation</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">dept_count</span><span class="syn-punct">(</span><span class="syn-variable">Dept</span><span class="syn-punct">,</span> <span class="syn-aggregate">count</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Id</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">works_in</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Dept</span><span class="syn-punct">)</span>
</code></pre>
<h2 id="examples" node="[object Object]">Examples</h2>
<h3 id="social-network" node="[object Object]">Social Network</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Facts</span>
<span class="syn-arith">+</span><span class="syn-identifier">follows</span><span class="syn-punct">[</span><span class="syn-punct">(</span><span class="syn-number">1</span><span class="syn-punct">,</span> <span class="syn-number">2</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-number">2</span><span class="syn-punct">,</span> <span class="syn-number">3</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-number">3</span><span class="syn-punct">,</span> <span class="syn-number">4</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-number">2</span><span class="syn-punct">,</span> <span class="syn-number">4</span><span class="syn-punct">)</span><span class="syn-punct">]</span>

<span class="syn-comment">// Find who user 1 can reach (transitive)</span>
<span class="syn-arith">+</span><span class="syn-identifier">can_reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">follows</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span>
<span class="syn-arith">+</span><span class="syn-identifier">can_reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">can_reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">follows</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span>

<span class="syn-comment">// Query</span>
<span class="syn-query">?</span><span class="syn-identifier">can_reach</span><span class="syn-punct">(</span><span class="syn-number">1</span><span class="syn-punct">,</span> <span class="syn-variable">X</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="access-control" node="[object Object]">Access Control</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Facts</span>
<span class="syn-arith">+</span><span class="syn-identifier">user_role</span><span class="syn-punct">[</span><span class="syn-punct">(</span><span class="syn-string">"alice"</span><span class="syn-punct">,</span> <span class="syn-string">"admin"</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-string">"bob"</span><span class="syn-punct">,</span> <span class="syn-string">"viewer"</span><span class="syn-punct">)</span><span class="syn-punct">]</span>
<span class="syn-arith">+</span><span class="syn-identifier">role_perm</span><span class="syn-punct">[</span><span class="syn-punct">(</span><span class="syn-string">"admin"</span><span class="syn-punct">,</span> <span class="syn-string">"read"</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-string">"admin"</span><span class="syn-punct">,</span> <span class="syn-string">"write"</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-string">"viewer"</span><span class="syn-punct">,</span> <span class="syn-string">"read"</span><span class="syn-punct">)</span><span class="syn-punct">]</span>

<span class="syn-comment">// Rule: user has permission via role</span>
<span class="syn-arith">+</span><span class="syn-identifier">has_perm</span><span class="syn-punct">(</span><span class="syn-variable">User</span><span class="syn-punct">,</span> <span class="syn-variable">Perm</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">user_role</span><span class="syn-punct">(</span><span class="syn-variable">User</span><span class="syn-punct">,</span> <span class="syn-variable">Role</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">role_perm</span><span class="syn-punct">(</span><span class="syn-variable">Role</span><span class="syn-punct">,</span> <span class="syn-variable">Perm</span><span class="syn-punct">)</span>

<span class="syn-comment">// Query</span>
<span class="syn-query">?</span><span class="syn-identifier">has_perm</span><span class="syn-punct">(</span><span class="syn-string">"alice"</span><span class="syn-punct">,</span> <span class="syn-variable">Perm</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="graph-analysis" node="[object Object]">Graph Analysis</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Facts</span>
<span class="syn-arith">+</span><span class="syn-identifier">edge</span><span class="syn-punct">[</span><span class="syn-punct">(</span><span class="syn-number">1</span><span class="syn-punct">,</span> <span class="syn-number">2</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-number">2</span><span class="syn-punct">,</span> <span class="syn-number">3</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-number">3</span><span class="syn-punct">,</span> <span class="syn-number">1</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-number">4</span><span class="syn-punct">,</span> <span class="syn-number">5</span><span class="syn-punct">)</span><span class="syn-punct">]</span>

<span class="syn-comment">// Nodes in same strongly connected component</span>
<span class="syn-arith">+</span><span class="syn-identifier">same_scc</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">reach</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">,</span> <span class="syn-variable">X</span><span class="syn-punct">)</span>
<span class="syn-arith">+</span><span class="syn-identifier">reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span>
<span class="syn-arith">+</span><span class="syn-identifier">reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">reach</span><span class="syn-punct">(</span><span class="syn-variable">X</span><span class="syn-punct">,</span> <span class="syn-variable">Y</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-body-id">edge</span><span class="syn-punct">(</span><span class="syn-variable">Y</span><span class="syn-punct">,</span> <span class="syn-variable">Z</span><span class="syn-punct">)</span>

<span class="syn-comment">// Query</span>
<span class="syn-query">?</span><span class="syn-identifier">same_scc</span><span class="syn-punct">(</span><span class="syn-number">1</span><span class="syn-punct">,</span> <span class="syn-variable">X</span><span class="syn-punct">)</span>
</code></pre></article></div><div class="hidden lg:block w-48 shrink-0 border-l border-border/50"><div class="sticky top-0 p-4"><p class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3">On this page</p><nav class="space-y-1"><a href="#session-rules" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Session Rules</a><a href="#managing-session-rules" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Managing Session Rules</a><a href="#persistent-rules" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Persistent Rules</a><a href="#multi-clause-rules" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Multi-Clause Rules</a><a href="#deleting-persistent-rules" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Deleting Persistent Rules</a><a href="#rule-structure" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Rule Structure</a><a href="#head" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Head</a><a href="#body" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Body</a><a href="#grammar" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Grammar</a><a href="#body-literals" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Body Literals</a><a href="#recursion" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Recursion</a><a href="#mutual-recursion" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Mutual Recursion</a><a href="#variable-safety-rules" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Variable Safety Rules</a><a href="#common-patterns" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Common Patterns</a><a href="#filter" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Filter</a><a href="#join" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Join</a><a href="#set-difference" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Set Difference</a><a href="#aggregation" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Aggregation</a><a href="#examples" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Examples</a><a href="#social-network" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Social Network</a><a href="#access-control" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Access Control</a><a href="#graph-analysis" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Graph Analysis</a></nav></div></div></div></div></div></div><!--$--><!--/$--><script src="/_next/static/chunks/webpack-bd6546b43ab2ecbf.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1942,[\"177\",\"static/chunks/app/layout-7e9963bf811be36b.js\"],\"ThemeProvider\"]\n3:I[7121,[],\"\"]\n4:I[4581,[],\"\"]\n6:I[484,[],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[484,[],\"ViewportBoundary\"]\nb:I[484,[],\"MetadataBoundary\"]\nd:I[7123,[],\"\"]\n:HL[\"/_next/static/media/4cf2300e9c8272f7-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/4bd7a24b7976d4e6.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"05bjYGyiAumoEMBrfWHih\",\"c\":[\"\",\"docs\",\"spec\",\"rules\",\"\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"spec/rules\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4bd7a24b7976d4e6.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_188709 __variable_9a8899 font-sans antialiased\",\"children\":[\"$\",\"$L2\",null,{\"attribute\":\"class\",\"defaultTheme\":\"dark\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:I[8428,[\"758\",\"static/chunks/758-3cb69ce377cde046.js\",\"121\",\"static/chunks/121-aece4f809b101dc1.js\",\"502\",\"static/chunks/502-e809071f8789437b.js\",\"689\",\"static/chunks/689-4fcf9680fdc90283.js\",\"870\",\"static/chunks/app/docs/%5B%5B...slug%5D%5D/page-004ec69e3c86920a.js\"],\"DocsPageClient\"]\nf:T14f3,"])</script><script>self.__next_f.push([1,"# Rules\n\nRules define derived relations (views) by computing new facts from existing data. InputLayer has two types of rules:\n\n| Type | Syntax | Persistence |\n|------|--------|-------------|\n| **Session rule** | `head \u003c- body` | Temporary, cleared on disconnect |\n| **Persistent rule** | `+head \u003c- body` | Saved to disk, survives restarts |\n\n## Session Rules\n\nSession rules exist only for your current connection:\n\n```datalog\n// Define a session rule\nancestor(X, Y) \u003c- parent(X, Y)\nancestor(X, Z) \u003c- ancestor(X, Y), parent(Y, Z)\n\n// Use it immediately\n?ancestor(\"alice\", X)\n\n// Rule is gone when you disconnect\n```\n\nSession rules are useful for:\n- Ad-hoc analysis\n- Experimenting with rule definitions\n- One-time computations\n\n### Managing Session Rules\n\n```\n.session              // List all session rules\n.session clear        // Clear all session rules\n.session drop 1       // Drop session rule #1\n```\n\n## Persistent Rules\n\nPersistent rules are saved to disk and automatically loaded:\n\n```datalog\n// Create a persistent rule (saved)\n+path(X, Y) \u003c- edge(X, Y)\n+path(X, Z) \u003c- path(X, Y), edge(Y, Z)\n\n// Works immediately and after restart\n?path(1, X)\n```\n\nPersistent rules are stored in `{data_dir}/{kg}/rules/catalog.json`.\n\n### Multi-Clause Rules\n\nA view can be defined by multiple rules (clauses):\n\n```datalog\n// First clause: base case\n+ancestor(X, Y) \u003c- parent(X, Y)\n\n// Second clause: recursive case\n+ancestor(X, Z) \u003c- parent(X, Y), ancestor(Y, Z)\n```\n\nBoth clauses define `ancestor`. Results are the union of all matching clauses.\n\n### Deleting Persistent Rules\n\nRemove a persistent rule with `-`:\n\n```datalog\n-path(X, Y)    // Removes all rules defining 'path'\n```\n\nOr use meta commands:\n\n```\n.rule drop path        // Drop 'path' rule\n.rule clear path       // Clear for re-registration\n```\n\n## Rule Structure\n\nA rule has two parts:\n\n```\nhead(Variables) \u003c- body\n     ^              ^\n  What to         What must\n  produce         be true\n```\n\n### Head\n\nThe head is an atom that defines what the rule produces:\n\n```datalog\n+path(X, Y) \u003c- edge(X, Y)\n// ^^^^^^^^\n// Head: produces facts for 'path' relation\n```\n\nThe head must use a **lowercase** predicate name.\n\n### Body\n\nThe body specifies conditions using literals separated by commas (AND):\n\n```datalog\n+employee_in_dept(Name, Dept) \u003c- employee(Id, Name), works_in(Id, Dept)\n//                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n//                                Body: both conditions must match\n```\n\n## Grammar\n\n```ebnf\nsession_rule    ::= head \"\u003c-\" body ;\npersistent_rule ::= \"+\" head \"\u003c-\" body ;\ndelete_rule     ::= \"-\" predicate \"(\" variables \")\" ;\nhead            ::= predicate \"(\" term (\",\" term)* \")\" ;\nbody            ::= literal (\",\" literal)* ;\n```\n\n## Body Literals\n\nThe body can contain:\n\n| Literal | Example | Meaning |\n|---------|---------|---------|\n| Positive atom | `edge(X, Y)` | Relation must have matching fact |\n| Negated atom | `!edge(X, Y)` | Relation must NOT have matching fact |\n| Comparison | `X \u003e 10` | Condition must be true |\n| Arithmetic | `Z = X + Y` | Compute and bind value |\n| Aggregation | `count\u003cX\u003e` | Aggregate over variable |\n\n## Recursion\n\nRules can reference themselves (recursion):\n\n```datalog\n// Transitive closure - find all reachable nodes\n+reach(X, Y) \u003c- edge(X, Y)\n+reach(X, Z) \u003c- reach(X, Y), edge(Y, Z)\n```\n\nInputLayer handles recursion automatically. It keeps computing until no new facts are found (fixpoint).\n\n### Mutual Recursion\n\nRules can reference each other:\n\n```datalog\n+even(0)\n+odd(X) \u003c- even(Y), succ(Y, X)\n+even(X) \u003c- odd(Y), succ(Y, X)\n```\n\n## Variable Safety Rules\n\nAll variables in the **head** must appear in a **positive** body literal:\n\n```datalog\n// GOOD: X appears in edge(X, Y)\n+start_nodes(X) \u003c- edge(X, Y)\n\n// BAD: X only in head, not in positive body literal\n+broken(X) \u003c- edge(A, B)   // ERROR: X is unbound\n```\n\nVariables in **negations** or **comparisons** must also appear in a positive literal:\n\n```datalog\n// GOOD: X is bound by edge, then filtered\n+filtered(X) \u003c- edge(X, Y), X \u003e 5\n\n// BAD: X only in comparison\n+broken(X) \u003c- Y \u003e 5   // ERROR: X unbound, Y only in comparison\n```\n\n## Common Patterns\n\n### Filter\n\n```datalog\n+adults(Name, Age) \u003c- person(Name, Age), Age \u003e= 18\n```\n\n### Join\n\n```datalog\n+employee_dept(Name, DeptName) \u003c-\n    employee(Id, Name),\n    works_in(Id, DeptId),\n    department(DeptId, DeptName)\n```\n\n### Set Difference\n\n```datalog\n+not_in_b(X) \u003c- a(X), !b(X)\n```\n\n### Aggregation\n\n```datalog\n+dept_count(Dept, count\u003cId\u003e) \u003c- works_in(Id, Dept)\n```\n\n## Examples\n\n### Social Network\n\n```datalog\n// Facts\n+follows[(1, 2), (2, 3), (3, 4), (2, 4)]\n\n// Find who user 1 can reach (transitive)\n+can_reach(X, Y) \u003c- follows(X, Y)\n+can_reach(X, Z) \u003c- can_reach(X, Y), follows(Y, Z)\n\n// Query\n?can_reach(1, X)\n```\n\n### Access Control\n\n```datalog\n// Facts\n+user_role[(\"alice\", \"admin\"), (\"bob\", \"viewer\")]\n+role_perm[(\"admin\", \"read\"), (\"admin\", \"write\"), (\"viewer\", \"read\")]\n\n// Rule: user has permission via role\n+has_perm(User, Perm) \u003c- user_role(User, Role), role_perm(Role, Perm)\n\n// Query\n?has_perm(\"alice\", Perm)\n```\n\n### Graph Analysis\n\n```datalog\n// Facts\n+edge[(1, 2), (2, 3), (3, 1), (4, 5)]\n\n// Nodes in same strongly connected component\n+same_scc(X, Y) \u003c- reach(X, Y), reach(Y, X)\n+reach(X, Y) \u003c- edge(X, Y)\n+reach(X, Z) \u003c- reach(X, Y), edge(Y, Z)\n\n// Query\n?same_scc(1, X)\n```"])</script><script>self.__next_f.push([1,"5:[\"$\",\"$Le\",null,{\"page\":{\"title\":\"Rules\",\"content\":\"$f\",\"toc\":[{\"level\":2,\"text\":\"Session Rules\",\"id\":\"session-rules\"},{\"level\":3,\"text\":\"Managing Session Rules\",\"id\":\"managing-session-rules\"},{\"level\":2,\"text\":\"Persistent Rules\",\"id\":\"persistent-rules\"},{\"level\":3,\"text\":\"Multi-Clause Rules\",\"id\":\"multi-clause-rules\"},{\"level\":3,\"text\":\"Deleting Persistent Rules\",\"id\":\"deleting-persistent-rules\"},{\"level\":2,\"text\":\"Rule Structure\",\"id\":\"rule-structure\"},{\"level\":3,\"text\":\"Head\",\"id\":\"head\"},{\"level\":3,\"text\":\"Body\",\"id\":\"body\"},{\"level\":2,\"text\":\"Grammar\",\"id\":\"grammar\"},{\"level\":2,\"text\":\"Body Literals\",\"id\":\"body-literals\"},{\"level\":2,\"text\":\"Recursion\",\"id\":\"recursion\"},{\"level\":3,\"text\":\"Mutual Recursion\",\"id\":\"mutual-recursion\"},{\"level\":2,\"text\":\"Variable Safety Rules\",\"id\":\"variable-safety-rules\"},{\"level\":2,\"text\":\"Common Patterns\",\"id\":\"common-patterns\"},{\"level\":3,\"text\":\"Filter\",\"id\":\"filter\"},{\"level\":3,\"text\":\"Join\",\"id\":\"join\"},{\"level\":3,\"text\":\"Set Difference\",\"id\":\"set-difference\"},{\"level\":3,\"text\":\"Aggregation\",\"id\":\"aggregation\"},{\"level\":2,\"text\":\"Examples\",\"id\":\"examples\"},{\"level\":3,\"text\":\"Social Network\",\"id\":\"social-network\"},{\"level\":3,\"text\":\"Access Control\",\"id\":\"access-control\"},{\"level\":3,\"text\":\"Graph Analysis\",\"id\":\"graph-analysis\"}]},\"slugKey\":\"spec/rules\"}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"10:I[6869,[],\"IconMark\"]\nc:[[\"$\",\"title\",\"0\",{\"children\":\"InputLayer - A symbolic reasoning engine for AI agents\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Store facts, define rules, and derive everything that logically follows. Vector search, graph traversal, and incremental computation in one system.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/icon.svg\"}],[\"$\",\"$L10\",\"3\",{}]]\n8:null\n"])</script></body></html>