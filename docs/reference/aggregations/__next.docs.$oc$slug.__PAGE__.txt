1:"$Sreact.fragment"
2:I[8428,["758","static/chunks/758-3cb69ce377cde046.js","121","static/chunks/121-aece4f809b101dc1.js","502","static/chunks/502-e809071f8789437b.js","689","static/chunks/689-4fcf9680fdc90283.js","870","static/chunks/app/docs/%5B%5B...slug%5D%5D/page-004ec69e3c86920a.js"],"DocsPageClient"]
5:I[484,[],"OutletBoundary"]
6:"$Sreact.suspense"
3:T1480,# Aggregations Reference

InputLayer supports 9 aggregation functions for computing summary values over groups of data.

## Basic Aggregations

### `count`

Count the number of results.

**Syntax:**
```datalog
count<Variable>
```

**Example:**
```datalog
// Count all users
+user_count(count<Id>) <- user(Id, _)

// Count users per department
+dept_count(Dept, count<Id>) <- user(Id, _, Dept)
```

**Returns:** Integer count of distinct bindings for the variable.

---

### `count_distinct`

Count distinct values of a variable.

**Syntax:**
```datalog
count_distinct<Variable>
```

**Example:**
```datalog
// Count unique departments
+unique_depts(count_distinct<Dept>) <- user(_, _, Dept)
```

**Returns:** Integer count of unique values.

---

### `sum`

Sum numeric values.

**Syntax:**
```datalog
sum<Variable>
```

**Example:**
```datalog
// Total salary per department
+dept_salary(Dept, sum<Salary>) <- employee(_, _, Dept, Salary)
```

**Returns:** Sum as Integer or Float (matches input type).

---

### `min`

Find minimum value.

**Syntax:**
```datalog
min<Variable>
```

**Example:**
```datalog
// Lowest price per category
+min_price(Category, min<Price>) <- product(_, Category, Price)
```

**Returns:** Minimum value (works with numbers and strings).

---

### `max`

Find maximum value.

**Syntax:**
```datalog
max<Variable>
```

**Example:**
```datalog
// Highest score per game
+high_score(Game, max<Score>) <- scores(_, Game, Score)
```

**Returns:** Maximum value (works with numbers and strings).

---

### `avg`

Compute average of numeric values.

**Syntax:**
```datalog
avg<Variable>
```

**Example:**
```datalog
// Average rating per product
+avg_rating(Product, avg<Rating>) <- reviews(_, Product, Rating)
```

**Returns:** Float average.

---

## Ranking Aggregations

### `top_k`

Select the top K results ordered by a variable.

**Syntax:**
```datalog
top_k<K, OrderVariable>           // Ascending order (lowest K)
top_k<K, OrderVariable, desc>     // Descending order (highest K)
```

**Parameters:**
- `K` - Number of results to return (integer)
- `OrderVariable` - Variable to order by
- `desc` - Optional: use descending order

**Example:**
```datalog
// Top 10 highest scores
+top_scores(Name, top_k<10, Score, desc>) <- scores(Name, Score)

// Top 5 nearest neighbors by distance
+nearest(Id, top_k<5, Dist>) <-
    query_vec(QV),
    vectors(Id, V),
    Dist = euclidean(QV, V)
```

**Returns:** Up to K results with the ordering value.

---

### `top_k_threshold`

Select top K results, but only if they meet a minimum threshold.

**Syntax:**
```datalog
top_k_threshold<K, Threshold, OrderVariable>           // Ascending (default)
top_k_threshold<K, Threshold, OrderVariable, desc>     // Descending
```

**Parameters:**
- `K` - Maximum number of results (integer)
- `Threshold` - Minimum (or maximum for desc) value to include (float)
- `OrderVariable` - Variable to order by (with optional `:desc`/`:asc` suffix)

**Example:**
```datalog
// Top 10 products, but only if rating >= 4.0
+top_rated(Product, top_k_threshold<10, 4.0, Rating, desc>) <-
    reviews(Product, Rating)

// Nearest 5 neighbors within distance 0.5
+near_enough(Id, top_k_threshold<5, 0.5, Dist>) <-
    query_vec(QV),
    vectors(Id, V),
    Dist = euclidean(QV, V)
```

**Returns:** Up to K results that meet the threshold.

---

### `within_radius`

Return all results within a distance threshold (range query).

**Syntax:**
```datalog
within_radius<MaxDistance, DistanceVariable>
```

**Parameters:**
- `MaxDistance` - Maximum distance to include (float)
- `DistanceVariable` - Variable containing the distance (with optional `:asc`/`:desc` suffix)

**Example:**
```datalog
// All vectors within distance 0.3
+nearby(Id, within_radius<0.3, Dist>) <-
    query_vec(QV),
    vectors(Id, V),
    Dist = cosine(QV, V)

// Vectors within distance 0.5
+close_vectors(Id, within_radius<0.5, D>) <-
    query_vec(QV),
    vectors(Id, V),
    D = euclidean(QV, V)
```

**Returns:** All results where distance <= MaxDistance.

---

## Aggregation Rules

### Grouping

Variables in the head that are NOT aggregated become grouping keys:

```datalog
// Group by Department, aggregate Salary
+dept_stats(Dept, sum<Salary>, avg<Salary>) <-
    employee(_, _, Dept, Salary)
```

### Multiple Aggregations

Multiple aggregations can be combined in one rule:

```datalog
+stats(count<Id>, min<Value>, max<Value>, avg<Value>) <-
    data(Id, Value)
```

### With Filters

Aggregations work with filter conditions:

```datalog
// Only count active users
+active_count(count<Id>) <- user(Id, Active), Active = true

// Sum only positive values
+positive_sum(sum<V>) <- values(V), V > 0
```

---

## Quick Reference

| Function | Syntax | Returns |
|----------|--------|---------|
| `count` | `count<X>` | Integer count |
| `count_distinct` | `count_distinct<X>` | Integer unique count |
| `sum` | `sum<X>` | Sum (Int or Float) |
| `min` | `min<X>` | Minimum value |
| `max` | `max<X>` | Maximum value |
| `avg` | `avg<X>` | Float average |
| `top_k` | `top_k<K, X>` or `top_k<K, X, desc>` | Top K results |
| `top_k_threshold` | `top_k_threshold<K, T, X>` | Top K meeting threshold |
| `within_radius` | `within_radius<Max, D>` | All within distance |0:{"buildId":"05bjYGyiAumoEMBrfWHih","rsc":["$","$1","c",{"children":[["$","$L2",null,{"page":{"title":"Aggregations Reference","content":"$3","toc":[{"level":2,"text":"Basic Aggregations","id":"basic-aggregations"},{"level":3,"text":"count","id":"count"},{"level":3,"text":"countdistinct","id":"countdistinct"},{"level":3,"text":"sum","id":"sum"},{"level":3,"text":"min","id":"min"},{"level":3,"text":"max","id":"max"},{"level":3,"text":"avg","id":"avg"},{"level":2,"text":"Ranking Aggregations","id":"ranking-aggregations"},{"level":3,"text":"topk","id":"topk"},{"level":3,"text":"topkthreshold","id":"topkthreshold"},{"level":3,"text":"withinradius","id":"withinradius"},{"level":2,"text":"Aggregation Rules","id":"aggregation-rules"},{"level":3,"text":"Grouping","id":"grouping"},{"level":3,"text":"Multiple Aggregations","id":"multiple-aggregations"},{"level":3,"text":"With Filters","id":"with-filters"},{"level":2,"text":"Quick Reference","id":"quick-reference"}]},"slugKey":"reference/aggregations"}],null,"$L4"]}],"loading":null,"isPartial":false}
4:["$","$L5",null,{"children":["$","$6",null,{"name":"Next.MetadataOutlet","children":"$@7"}]}]
7:null
