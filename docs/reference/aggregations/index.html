<!DOCTYPE html><!--05bjYGyiAumoEMBrfWHih--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/4cf2300e9c8272f7-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/4bd7a24b7976d4e6.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-bd6546b43ab2ecbf.js"/><script src="/_next/static/chunks/4bd1b696-deba172d32c79f82.js" async=""></script><script src="/_next/static/chunks/794-275dc9ebd3a29fbf.js" async=""></script><script src="/_next/static/chunks/main-app-1fa5b694e5d36a75.js" async=""></script><script src="/_next/static/chunks/app/layout-7e9963bf811be36b.js" async=""></script><script src="/_next/static/chunks/758-3cb69ce377cde046.js" async=""></script><script src="/_next/static/chunks/121-aece4f809b101dc1.js" async=""></script><script src="/_next/static/chunks/502-e809071f8789437b.js" async=""></script><script src="/_next/static/chunks/689-4fcf9680fdc90283.js" async=""></script><script src="/_next/static/chunks/app/docs/%5B%5B...slug%5D%5D/page-004ec69e3c86920a.js" async=""></script><meta name="next-size-adjust" content=""/><title>InputLayer - A symbolic reasoning engine for AI agents</title><meta name="description" content="Store facts, define rules, and derive everything that logically follows. Vector search, graph traversal, and incremental computation in one system."/><link rel="icon" href="/icon.svg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_188709 __variable_9a8899 font-sans antialiased"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","dark",null,["light","dark"],null,true,true)</script><div class="flex flex-col h-dvh"><header class="sticky top-0 z-50 w-full border-b border-border/50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"><div class="flex h-14 items-center px-6"><a class="mr-8" href="/"><span class="inline-flex items-center gap-1.5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg><span class="font-extrabold tracking-tight text-lg">InputLayer</span></span></a><nav class="hidden md:flex items-center gap-6 text-sm"><a class="text-muted-foreground transition-colors hover:text-foreground" href="/docs/">Docs</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/blog/">Blog</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/use-cases/">Use Cases</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/compare/">Compare</a><a href="https://demo.inputlayer.ai" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 text-muted-foreground transition-colors hover:text-foreground">Demo<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link h-3 w-3"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg></a></nav><div class="ml-auto flex items-center gap-3"><div class="inline-flex items-center gap-1.5"><a href="https://github.com/inputlayer/inputlayer" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 rounded-md border border-border bg-secondary/50 px-2.5 py-1 text-xs font-medium text-muted-foreground transition-colors hover:text-foreground hover:bg-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star h-3.5 w-3.5"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"></path></svg><span>Star</span></a><a href="https://github.com/inputlayer/inputlayer/fork" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 rounded-md border border-border bg-secondary/50 px-2.5 py-1 text-xs font-medium text-muted-foreground transition-colors hover:text-foreground hover:bg-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-git-fork h-3.5 w-3.5"><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path><path d="M12 12v3"></path></svg><span>Fork</span></a></div><button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 size-9 h-9 w-9"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun h-4 w-4"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg></button><div class="md:hidden"><button class="inline-flex items-center justify-center rounded-md p-2 text-muted-foreground hover:text-foreground hover:bg-secondary transition-colors" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-5 w-5"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button></div></div></div></header><div class="flex flex-1 overflow-hidden"><div class="w-64 shrink-0 border-r border-border/50 overflow-y-auto"><div class="flex flex-col h-full"><div class="p-3 border-b border-border/50"><div class="relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><input type="text" placeholder="Search docs..." class="w-full h-8 pl-8 pr-3 text-sm rounded-md border border-border bg-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring" value=""/></div></div><nav class="flex-1 overflow-y-auto p-2 space-y-0.5"><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" href="/docs/index/">Overview</a><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_j6av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Guides</button><div data-state="closed" id="radix-_R_j6av5ubtb_" hidden="" data-slot="collapsible-content"></div></div><div data-state="open" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-foreground font-medium" style="padding-left:12px" type="button" aria-controls="radix-_R_r6av5ubtb_" aria-expanded="true" data-state="open" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform rotate-90"><path d="m9 18 6-6-6-6"></path></svg>Reference</button><div data-state="open" id="radix-_R_r6av5ubtb_" data-slot="collapsible-content"><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/reference/index/">Overview</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/reference/commands/">Commands</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/reference/functions/">Functions</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/reference/syntax/">Syntax</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/reference/syntax-cheatsheet/">Syntax Cheatsheet</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors bg-primary/10 text-primary font-medium" style="padding-left:24px" href="/docs/reference/aggregations/">Aggregations</a></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_136av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Specification</button><div data-state="closed" id="radix-_R_136av5ubtb_" hidden="" data-slot="collapsible-content"></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_1b6av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Internals</button><div data-state="closed" id="radix-_R_1b6av5ubtb_" hidden="" data-slot="collapsible-content"></div></div></nav></div></div><div class="flex flex-1 flex-col overflow-hidden"><div class="flex flex-1 overflow-hidden"><div class="flex-1 overflow-y-auto px-8 py-6 max-w-4xl mx-auto"><article class="docs-prose"><h1 id="aggregations-reference" node="[object Object]">Aggregations Reference</h1>
<p>InputLayer supports 9 aggregation functions for computing summary values over groups of data.</p>
<h2 id="basic-aggregations" node="[object Object]">Basic Aggregations</h2>
<h3 id="object-object" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">count</code></h3>
<p>Count the number of results.</p>
<p><strong>Syntax:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-aggregate">count</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Variable</span><span class="syn-comparison">&gt;</span>
</code></pre>
<p><strong>Example:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Count all users</span>
<span class="syn-arith">+</span><span class="syn-identifier">user_count</span><span class="syn-punct">(</span><span class="syn-aggregate">count</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Id</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">user</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">)</span>

<span class="syn-comment">// Count users per department</span>
<span class="syn-arith">+</span><span class="syn-identifier">dept_count</span><span class="syn-punct">(</span><span class="syn-variable">Dept</span><span class="syn-punct">,</span> <span class="syn-aggregate">count</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Id</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">user</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">Dept</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Returns:</strong> Integer count of distinct bindings for the variable.</p>
<hr/>
<h3 id="object-object" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">count_distinct</code></h3>
<p>Count distinct values of a variable.</p>
<p><strong>Syntax:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-aggregate">count_distinct</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Variable</span><span class="syn-comparison">&gt;</span>
</code></pre>
<p><strong>Example:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Count unique departments</span>
<span class="syn-arith">+</span><span class="syn-identifier">unique_depts</span><span class="syn-punct">(</span><span class="syn-aggregate">count_distinct</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Dept</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">user</span><span class="syn-punct">(</span><span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">Dept</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Returns:</strong> Integer count of unique values.</p>
<hr/>
<h3 id="object-object" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">sum</code></h3>
<p>Sum numeric values.</p>
<p><strong>Syntax:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-aggregate">sum</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Variable</span><span class="syn-comparison">&gt;</span>
</code></pre>
<p><strong>Example:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Total salary per department</span>
<span class="syn-arith">+</span><span class="syn-identifier">dept_salary</span><span class="syn-punct">(</span><span class="syn-variable">Dept</span><span class="syn-punct">,</span> <span class="syn-aggregate">sum</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Salary</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">employee</span><span class="syn-punct">(</span><span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">Dept</span><span class="syn-punct">,</span> <span class="syn-variable">Salary</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Returns:</strong> Sum as Integer or Float (matches input type).</p>
<hr/>
<h3 id="object-object" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">min</code></h3>
<p>Find minimum value.</p>
<p><strong>Syntax:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-aggregate">min</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Variable</span><span class="syn-comparison">&gt;</span>
</code></pre>
<p><strong>Example:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Lowest price per category</span>
<span class="syn-arith">+</span><span class="syn-identifier">min_price</span><span class="syn-punct">(</span><span class="syn-variable">Category</span><span class="syn-punct">,</span> <span class="syn-aggregate">min</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Price</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">product</span><span class="syn-punct">(</span><span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">Category</span><span class="syn-punct">,</span> <span class="syn-variable">Price</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Returns:</strong> Minimum value (works with numbers and strings).</p>
<hr/>
<h3 id="object-object" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">max</code></h3>
<p>Find maximum value.</p>
<p><strong>Syntax:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-aggregate">max</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Variable</span><span class="syn-comparison">&gt;</span>
</code></pre>
<p><strong>Example:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Highest score per game</span>
<span class="syn-arith">+</span><span class="syn-identifier">high_score</span><span class="syn-punct">(</span><span class="syn-variable">Game</span><span class="syn-punct">,</span> <span class="syn-aggregate">max</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Score</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">scores</span><span class="syn-punct">(</span><span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">Game</span><span class="syn-punct">,</span> <span class="syn-variable">Score</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Returns:</strong> Maximum value (works with numbers and strings).</p>
<hr/>
<h3 id="object-object" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">avg</code></h3>
<p>Compute average of numeric values.</p>
<p><strong>Syntax:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-aggregate">avg</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Variable</span><span class="syn-comparison">&gt;</span>
</code></pre>
<p><strong>Example:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Average rating per product</span>
<span class="syn-arith">+</span><span class="syn-identifier">avg_rating</span><span class="syn-punct">(</span><span class="syn-variable">Product</span><span class="syn-punct">,</span> <span class="syn-aggregate">avg</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Rating</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">reviews</span><span class="syn-punct">(</span><span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">Product</span><span class="syn-punct">,</span> <span class="syn-variable">Rating</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Returns:</strong> Float average.</p>
<hr/>
<h2 id="ranking-aggregations" node="[object Object]">Ranking Aggregations</h2>
<h3 id="object-object" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">top_k</code></h3>
<p>Select the top K results ordered by a variable.</p>
<p><strong>Syntax:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-aggregate">top_k</span><span class="syn-comparison">&lt;</span><span class="syn-variable">K</span><span class="syn-punct">,</span> <span class="syn-variable">OrderVariable</span><span class="syn-comparison">&gt;</span>           <span class="syn-comment">// Ascending order (lowest K)</span>
<span class="syn-aggregate">top_k</span><span class="syn-comparison">&lt;</span><span class="syn-variable">K</span><span class="syn-punct">,</span> <span class="syn-variable">OrderVariable</span><span class="syn-punct">,</span> <span class="syn-identifier">desc</span><span class="syn-comparison">&gt;</span>     <span class="syn-comment">// Descending order (highest K)</span>
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">K</code> - Number of results to return (integer)</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">OrderVariable</code> - Variable to order by</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">desc</code> - Optional: use descending order</li>
</ul>
<p><strong>Example:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Top 10 highest scores</span>
<span class="syn-arith">+</span><span class="syn-identifier">top_scores</span><span class="syn-punct">(</span><span class="syn-variable">Name</span><span class="syn-punct">,</span> <span class="syn-aggregate">top_k</span><span class="syn-comparison">&lt;</span><span class="syn-number">10</span><span class="syn-punct">,</span> <span class="syn-variable">Score</span><span class="syn-punct">,</span> <span class="syn-identifier">desc</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">scores</span><span class="syn-punct">(</span><span class="syn-variable">Name</span><span class="syn-punct">,</span> <span class="syn-variable">Score</span><span class="syn-punct">)</span>

<span class="syn-comment">// Top 5 nearest neighbors by distance</span>
<span class="syn-arith">+</span><span class="syn-identifier">nearest</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-aggregate">top_k</span><span class="syn-comparison">&lt;</span><span class="syn-number">5</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">query_vec</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">vectors</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">euclidean</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Returns:</strong> Up to K results with the ordering value.</p>
<hr/>
<h3 id="object-object" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">top_k_threshold</code></h3>
<p>Select top K results, but only if they meet a minimum threshold.</p>
<p><strong>Syntax:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-aggregate">top_k_threshold</span><span class="syn-comparison">&lt;</span><span class="syn-variable">K</span><span class="syn-punct">,</span> <span class="syn-variable">Threshold</span><span class="syn-punct">,</span> <span class="syn-variable">OrderVariable</span><span class="syn-comparison">&gt;</span>           <span class="syn-comment">// Ascending (default)</span>
<span class="syn-aggregate">top_k_threshold</span><span class="syn-comparison">&lt;</span><span class="syn-variable">K</span><span class="syn-punct">,</span> <span class="syn-variable">Threshold</span><span class="syn-punct">,</span> <span class="syn-variable">OrderVariable</span><span class="syn-punct">,</span> <span class="syn-identifier">desc</span><span class="syn-comparison">&gt;</span>     <span class="syn-comment">// Descending</span>
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">K</code> - Maximum number of results (integer)</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">Threshold</code> - Minimum (or maximum for desc) value to include (float)</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">OrderVariable</code> - Variable to order by (with optional <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">:desc</code>/<code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">:asc</code> suffix)</li>
</ul>
<p><strong>Example:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Top 10 products, but only if rating &gt;= 4.0</span>
<span class="syn-arith">+</span><span class="syn-identifier">top_rated</span><span class="syn-punct">(</span><span class="syn-variable">Product</span><span class="syn-punct">,</span> <span class="syn-aggregate">top_k_threshold</span><span class="syn-comparison">&lt;</span><span class="syn-number">10</span><span class="syn-punct">,</span> <span class="syn-number">4.0</span><span class="syn-punct">,</span> <span class="syn-variable">Rating</span><span class="syn-punct">,</span> <span class="syn-identifier">desc</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">reviews</span><span class="syn-punct">(</span><span class="syn-variable">Product</span><span class="syn-punct">,</span> <span class="syn-variable">Rating</span><span class="syn-punct">)</span>

<span class="syn-comment">// Nearest 5 neighbors within distance 0.5</span>
<span class="syn-arith">+</span><span class="syn-identifier">near_enough</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-aggregate">top_k_threshold</span><span class="syn-comparison">&lt;</span><span class="syn-number">5</span><span class="syn-punct">,</span> <span class="syn-number">0.5</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">query_vec</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">vectors</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">euclidean</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Returns:</strong> Up to K results that meet the threshold.</p>
<hr/>
<h3 id="object-object" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">within_radius</code></h3>
<p>Return all results within a distance threshold (range query).</p>
<p><strong>Syntax:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-aggregate">within_radius</span><span class="syn-comparison">&lt;</span><span class="syn-variable">MaxDistance</span><span class="syn-punct">,</span> <span class="syn-variable">DistanceVariable</span><span class="syn-comparison">&gt;</span>
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">MaxDistance</code> - Maximum distance to include (float)</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">DistanceVariable</code> - Variable containing the distance (with optional <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">:asc</code>/<code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">:desc</code> suffix)</li>
</ul>
<p><strong>Example:</strong></p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// All vectors within distance 0.3</span>
<span class="syn-arith">+</span><span class="syn-identifier">nearby</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-aggregate">within_radius</span><span class="syn-comparison">&lt;</span><span class="syn-number">0.3</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">query_vec</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">vectors</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">cosine</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>

<span class="syn-comment">// Vectors within distance 0.5</span>
<span class="syn-arith">+</span><span class="syn-identifier">close_vectors</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-aggregate">within_radius</span><span class="syn-comparison">&lt;</span><span class="syn-number">0.5</span><span class="syn-punct">,</span> <span class="syn-variable">D</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">query_vec</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">vectors</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-variable">D</span> <span class="syn-comparison">=</span> <span class="syn-builtin">euclidean</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Returns:</strong> All results where distance &lt;= MaxDistance.</p>
<hr/>
<h2 id="aggregation-rules" node="[object Object]">Aggregation Rules</h2>
<h3 id="grouping" node="[object Object]">Grouping</h3>
<p>Variables in the head that are NOT aggregated become grouping keys:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Group by Department, aggregate Salary</span>
<span class="syn-arith">+</span><span class="syn-identifier">dept_stats</span><span class="syn-punct">(</span><span class="syn-variable">Dept</span><span class="syn-punct">,</span> <span class="syn-aggregate">sum</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Salary</span><span class="syn-comparison">&gt;</span><span class="syn-punct">,</span> <span class="syn-aggregate">avg</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Salary</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">employee</span><span class="syn-punct">(</span><span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">Dept</span><span class="syn-punct">,</span> <span class="syn-variable">Salary</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="multiple-aggregations" node="[object Object]">Multiple Aggregations</h3>
<p>Multiple aggregations can be combined in one rule:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">stats</span><span class="syn-punct">(</span><span class="syn-aggregate">count</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Id</span><span class="syn-comparison">&gt;</span><span class="syn-punct">,</span> <span class="syn-aggregate">min</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Value</span><span class="syn-comparison">&gt;</span><span class="syn-punct">,</span> <span class="syn-aggregate">max</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Value</span><span class="syn-comparison">&gt;</span><span class="syn-punct">,</span> <span class="syn-aggregate">avg</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Value</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">data</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Value</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="with-filters" node="[object Object]">With Filters</h3>
<p>Aggregations work with filter conditions:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Only count active users</span>
<span class="syn-arith">+</span><span class="syn-identifier">active_count</span><span class="syn-punct">(</span><span class="syn-aggregate">count</span><span class="syn-comparison">&lt;</span><span class="syn-variable">Id</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">user</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Active</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-variable">Active</span> <span class="syn-comparison">=</span> <span class="syn-keyword">true</span>

<span class="syn-comment">// Sum only positive values</span>
<span class="syn-arith">+</span><span class="syn-identifier">positive_sum</span><span class="syn-punct">(</span><span class="syn-aggregate">sum</span><span class="syn-comparison">&lt;</span><span class="syn-variable">V</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">values</span><span class="syn-punct">(</span><span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-variable">V</span> <span class="syn-comparison">&gt;</span> <span class="syn-number">0</span>
</code></pre>
<hr/>
<h2 id="quick-reference" node="[object Object]">Quick Reference</h2>
<div class="my-4 overflow-x-auto"><table class="w-full border-collapse" node="[object Object]"><thead><tr><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Function</th><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Syntax</th><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Returns</th></tr></thead><tbody><tr><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">count</code></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">count&lt;X&gt;</code></td><td class="border px-4 py-2" node="[object Object]">Integer count</td></tr><tr><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">count_distinct</code></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">count_distinct&lt;X&gt;</code></td><td class="border px-4 py-2" node="[object Object]">Integer unique count</td></tr><tr><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">sum</code></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">sum&lt;X&gt;</code></td><td class="border px-4 py-2" node="[object Object]">Sum (Int or Float)</td></tr><tr><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">min</code></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">min&lt;X&gt;</code></td><td class="border px-4 py-2" node="[object Object]">Minimum value</td></tr><tr><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">max</code></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">max&lt;X&gt;</code></td><td class="border px-4 py-2" node="[object Object]">Maximum value</td></tr><tr><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">avg</code></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">avg&lt;X&gt;</code></td><td class="border px-4 py-2" node="[object Object]">Float average</td></tr><tr><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">top_k</code></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">top_k&lt;K, X&gt;</code> or <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">top_k&lt;K, X, desc&gt;</code></td><td class="border px-4 py-2" node="[object Object]">Top K results</td></tr><tr><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">top_k_threshold</code></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">top_k_threshold&lt;K, T, X&gt;</code></td><td class="border px-4 py-2" node="[object Object]">Top K meeting threshold</td></tr><tr><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">within_radius</code></td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">within_radius&lt;Max, D&gt;</code></td><td class="border px-4 py-2" node="[object Object]">All within distance</td></tr></tbody></table></div></article></div><div class="hidden lg:block w-48 shrink-0 border-l border-border/50"><div class="sticky top-0 p-4"><p class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3">On this page</p><nav class="space-y-1"><a href="#basic-aggregations" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Basic Aggregations</a><a href="#count" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">count</a><a href="#countdistinct" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">countdistinct</a><a href="#sum" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">sum</a><a href="#min" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">min</a><a href="#max" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">max</a><a href="#avg" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">avg</a><a href="#ranking-aggregations" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Ranking Aggregations</a><a href="#topk" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">topk</a><a href="#topkthreshold" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">topkthreshold</a><a href="#withinradius" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">withinradius</a><a href="#aggregation-rules" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Aggregation Rules</a><a href="#grouping" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Grouping</a><a href="#multiple-aggregations" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Multiple Aggregations</a><a href="#with-filters" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">With Filters</a><a href="#quick-reference" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Quick Reference</a></nav></div></div></div></div></div></div><!--$--><!--/$--><script src="/_next/static/chunks/webpack-bd6546b43ab2ecbf.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1942,[\"177\",\"static/chunks/app/layout-7e9963bf811be36b.js\"],\"ThemeProvider\"]\n3:I[7121,[],\"\"]\n4:I[4581,[],\"\"]\n6:I[484,[],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[484,[],\"ViewportBoundary\"]\nb:I[484,[],\"MetadataBoundary\"]\nd:I[7123,[],\"\"]\n:HL[\"/_next/static/media/4cf2300e9c8272f7-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/4bd7a24b7976d4e6.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"05bjYGyiAumoEMBrfWHih\",\"c\":[\"\",\"docs\",\"reference\",\"aggregations\",\"\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"reference/aggregations\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4bd7a24b7976d4e6.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_188709 __variable_9a8899 font-sans antialiased\",\"children\":[\"$\",\"$L2\",null,{\"attribute\":\"class\",\"defaultTheme\":\"dark\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:I[8428,[\"758\",\"static/chunks/758-3cb69ce377cde046.js\",\"121\",\"static/chunks/121-aece4f809b101dc1.js\",\"502\",\"static/chunks/502-e809071f8789437b.js\",\"689\",\"static/chunks/689-4fcf9680fdc90283.js\",\"870\",\"static/chunks/app/docs/%5B%5B...slug%5D%5D/page-004ec69e3c86920a.js\"],\"DocsPageClient\"]\nf:T1480,"])</script><script>self.__next_f.push([1,"# Aggregations Reference\n\nInputLayer supports 9 aggregation functions for computing summary values over groups of data.\n\n## Basic Aggregations\n\n### `count`\n\nCount the number of results.\n\n**Syntax:**\n```datalog\ncount\u003cVariable\u003e\n```\n\n**Example:**\n```datalog\n// Count all users\n+user_count(count\u003cId\u003e) \u003c- user(Id, _)\n\n// Count users per department\n+dept_count(Dept, count\u003cId\u003e) \u003c- user(Id, _, Dept)\n```\n\n**Returns:** Integer count of distinct bindings for the variable.\n\n---\n\n### `count_distinct`\n\nCount distinct values of a variable.\n\n**Syntax:**\n```datalog\ncount_distinct\u003cVariable\u003e\n```\n\n**Example:**\n```datalog\n// Count unique departments\n+unique_depts(count_distinct\u003cDept\u003e) \u003c- user(_, _, Dept)\n```\n\n**Returns:** Integer count of unique values.\n\n---\n\n### `sum`\n\nSum numeric values.\n\n**Syntax:**\n```datalog\nsum\u003cVariable\u003e\n```\n\n**Example:**\n```datalog\n// Total salary per department\n+dept_salary(Dept, sum\u003cSalary\u003e) \u003c- employee(_, _, Dept, Salary)\n```\n\n**Returns:** Sum as Integer or Float (matches input type).\n\n---\n\n### `min`\n\nFind minimum value.\n\n**Syntax:**\n```datalog\nmin\u003cVariable\u003e\n```\n\n**Example:**\n```datalog\n// Lowest price per category\n+min_price(Category, min\u003cPrice\u003e) \u003c- product(_, Category, Price)\n```\n\n**Returns:** Minimum value (works with numbers and strings).\n\n---\n\n### `max`\n\nFind maximum value.\n\n**Syntax:**\n```datalog\nmax\u003cVariable\u003e\n```\n\n**Example:**\n```datalog\n// Highest score per game\n+high_score(Game, max\u003cScore\u003e) \u003c- scores(_, Game, Score)\n```\n\n**Returns:** Maximum value (works with numbers and strings).\n\n---\n\n### `avg`\n\nCompute average of numeric values.\n\n**Syntax:**\n```datalog\navg\u003cVariable\u003e\n```\n\n**Example:**\n```datalog\n// Average rating per product\n+avg_rating(Product, avg\u003cRating\u003e) \u003c- reviews(_, Product, Rating)\n```\n\n**Returns:** Float average.\n\n---\n\n## Ranking Aggregations\n\n### `top_k`\n\nSelect the top K results ordered by a variable.\n\n**Syntax:**\n```datalog\ntop_k\u003cK, OrderVariable\u003e           // Ascending order (lowest K)\ntop_k\u003cK, OrderVariable, desc\u003e     // Descending order (highest K)\n```\n\n**Parameters:**\n- `K` - Number of results to return (integer)\n- `OrderVariable` - Variable to order by\n- `desc` - Optional: use descending order\n\n**Example:**\n```datalog\n// Top 10 highest scores\n+top_scores(Name, top_k\u003c10, Score, desc\u003e) \u003c- scores(Name, Score)\n\n// Top 5 nearest neighbors by distance\n+nearest(Id, top_k\u003c5, Dist\u003e) \u003c-\n    query_vec(QV),\n    vectors(Id, V),\n    Dist = euclidean(QV, V)\n```\n\n**Returns:** Up to K results with the ordering value.\n\n---\n\n### `top_k_threshold`\n\nSelect top K results, but only if they meet a minimum threshold.\n\n**Syntax:**\n```datalog\ntop_k_threshold\u003cK, Threshold, OrderVariable\u003e           // Ascending (default)\ntop_k_threshold\u003cK, Threshold, OrderVariable, desc\u003e     // Descending\n```\n\n**Parameters:**\n- `K` - Maximum number of results (integer)\n- `Threshold` - Minimum (or maximum for desc) value to include (float)\n- `OrderVariable` - Variable to order by (with optional `:desc`/`:asc` suffix)\n\n**Example:**\n```datalog\n// Top 10 products, but only if rating \u003e= 4.0\n+top_rated(Product, top_k_threshold\u003c10, 4.0, Rating, desc\u003e) \u003c-\n    reviews(Product, Rating)\n\n// Nearest 5 neighbors within distance 0.5\n+near_enough(Id, top_k_threshold\u003c5, 0.5, Dist\u003e) \u003c-\n    query_vec(QV),\n    vectors(Id, V),\n    Dist = euclidean(QV, V)\n```\n\n**Returns:** Up to K results that meet the threshold.\n\n---\n\n### `within_radius`\n\nReturn all results within a distance threshold (range query).\n\n**Syntax:**\n```datalog\nwithin_radius\u003cMaxDistance, DistanceVariable\u003e\n```\n\n**Parameters:**\n- `MaxDistance` - Maximum distance to include (float)\n- `DistanceVariable` - Variable containing the distance (with optional `:asc`/`:desc` suffix)\n\n**Example:**\n```datalog\n// All vectors within distance 0.3\n+nearby(Id, within_radius\u003c0.3, Dist\u003e) \u003c-\n    query_vec(QV),\n    vectors(Id, V),\n    Dist = cosine(QV, V)\n\n// Vectors within distance 0.5\n+close_vectors(Id, within_radius\u003c0.5, D\u003e) \u003c-\n    query_vec(QV),\n    vectors(Id, V),\n    D = euclidean(QV, V)\n```\n\n**Returns:** All results where distance \u003c= MaxDistance.\n\n---\n\n## Aggregation Rules\n\n### Grouping\n\nVariables in the head that are NOT aggregated become grouping keys:\n\n```datalog\n// Group by Department, aggregate Salary\n+dept_stats(Dept, sum\u003cSalary\u003e, avg\u003cSalary\u003e) \u003c-\n    employee(_, _, Dept, Salary)\n```\n\n### Multiple Aggregations\n\nMultiple aggregations can be combined in one rule:\n\n```datalog\n+stats(count\u003cId\u003e, min\u003cValue\u003e, max\u003cValue\u003e, avg\u003cValue\u003e) \u003c-\n    data(Id, Value)\n```\n\n### With Filters\n\nAggregations work with filter conditions:\n\n```datalog\n// Only count active users\n+active_count(count\u003cId\u003e) \u003c- user(Id, Active), Active = true\n\n// Sum only positive values\n+positive_sum(sum\u003cV\u003e) \u003c- values(V), V \u003e 0\n```\n\n---\n\n## Quick Reference\n\n| Function | Syntax | Returns |\n|----------|--------|---------|\n| `count` | `count\u003cX\u003e` | Integer count |\n| `count_distinct` | `count_distinct\u003cX\u003e` | Integer unique count |\n| `sum` | `sum\u003cX\u003e` | Sum (Int or Float) |\n| `min` | `min\u003cX\u003e` | Minimum value |\n| `max` | `max\u003cX\u003e` | Maximum value |\n| `avg` | `avg\u003cX\u003e` | Float average |\n| `top_k` | `top_k\u003cK, X\u003e` or `top_k\u003cK, X, desc\u003e` | Top K results |\n| `top_k_threshold` | `top_k_threshold\u003cK, T, X\u003e` | Top K meeting threshold |\n| `within_radius` | `within_radius\u003cMax, D\u003e` | All within distance |"])</script><script>self.__next_f.push([1,"5:[\"$\",\"$Le\",null,{\"page\":{\"title\":\"Aggregations Reference\",\"content\":\"$f\",\"toc\":[{\"level\":2,\"text\":\"Basic Aggregations\",\"id\":\"basic-aggregations\"},{\"level\":3,\"text\":\"count\",\"id\":\"count\"},{\"level\":3,\"text\":\"countdistinct\",\"id\":\"countdistinct\"},{\"level\":3,\"text\":\"sum\",\"id\":\"sum\"},{\"level\":3,\"text\":\"min\",\"id\":\"min\"},{\"level\":3,\"text\":\"max\",\"id\":\"max\"},{\"level\":3,\"text\":\"avg\",\"id\":\"avg\"},{\"level\":2,\"text\":\"Ranking Aggregations\",\"id\":\"ranking-aggregations\"},{\"level\":3,\"text\":\"topk\",\"id\":\"topk\"},{\"level\":3,\"text\":\"topkthreshold\",\"id\":\"topkthreshold\"},{\"level\":3,\"text\":\"withinradius\",\"id\":\"withinradius\"},{\"level\":2,\"text\":\"Aggregation Rules\",\"id\":\"aggregation-rules\"},{\"level\":3,\"text\":\"Grouping\",\"id\":\"grouping\"},{\"level\":3,\"text\":\"Multiple Aggregations\",\"id\":\"multiple-aggregations\"},{\"level\":3,\"text\":\"With Filters\",\"id\":\"with-filters\"},{\"level\":2,\"text\":\"Quick Reference\",\"id\":\"quick-reference\"}]},\"slugKey\":\"reference/aggregations\"}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"10:I[6869,[],\"IconMark\"]\nc:[[\"$\",\"title\",\"0\",{\"children\":\"InputLayer - A symbolic reasoning engine for AI agents\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Store facts, define rules, and derive everything that logically follows. Vector search, graph traversal, and incremental computation in one system.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/icon.svg\"}],[\"$\",\"$L10\",\"3\",{}]]\n8:null\n"])</script></body></html>