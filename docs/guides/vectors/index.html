<!DOCTYPE html><!--05bjYGyiAumoEMBrfWHih--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/4cf2300e9c8272f7-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/4bd7a24b7976d4e6.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-bd6546b43ab2ecbf.js"/><script src="/_next/static/chunks/4bd1b696-deba172d32c79f82.js" async=""></script><script src="/_next/static/chunks/794-275dc9ebd3a29fbf.js" async=""></script><script src="/_next/static/chunks/main-app-1fa5b694e5d36a75.js" async=""></script><script src="/_next/static/chunks/app/layout-7e9963bf811be36b.js" async=""></script><script src="/_next/static/chunks/758-3cb69ce377cde046.js" async=""></script><script src="/_next/static/chunks/121-aece4f809b101dc1.js" async=""></script><script src="/_next/static/chunks/502-e809071f8789437b.js" async=""></script><script src="/_next/static/chunks/689-4fcf9680fdc90283.js" async=""></script><script src="/_next/static/chunks/app/docs/%5B%5B...slug%5D%5D/page-004ec69e3c86920a.js" async=""></script><meta name="next-size-adjust" content=""/><title>InputLayer - A symbolic reasoning engine for AI agents</title><meta name="description" content="Store facts, define rules, and derive everything that logically follows. Vector search, graph traversal, and incremental computation in one system."/><link rel="icon" href="/icon.svg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_188709 __variable_9a8899 font-sans antialiased"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","dark",null,["light","dark"],null,true,true)</script><div class="flex flex-col h-dvh"><header class="sticky top-0 z-50 w-full border-b border-border/50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"><div class="flex h-14 items-center px-6"><a class="mr-8" href="/"><span class="inline-flex items-center gap-1.5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg><span class="font-extrabold tracking-tight text-lg">InputLayer</span></span></a><nav class="hidden md:flex items-center gap-6 text-sm"><a class="text-muted-foreground transition-colors hover:text-foreground" href="/docs/">Docs</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/blog/">Blog</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/use-cases/">Use Cases</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/compare/">Compare</a><a href="https://demo.inputlayer.ai" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 text-muted-foreground transition-colors hover:text-foreground">Demo<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link h-3 w-3"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg></a></nav><div class="ml-auto flex items-center gap-3"><div class="inline-flex items-center gap-1.5"><a href="https://github.com/inputlayer/inputlayer" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 rounded-md border border-border bg-secondary/50 px-2.5 py-1 text-xs font-medium text-muted-foreground transition-colors hover:text-foreground hover:bg-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star h-3.5 w-3.5"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"></path></svg><span>Star</span></a><a href="https://github.com/inputlayer/inputlayer/fork" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 rounded-md border border-border bg-secondary/50 px-2.5 py-1 text-xs font-medium text-muted-foreground transition-colors hover:text-foreground hover:bg-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-git-fork h-3.5 w-3.5"><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path><path d="M12 12v3"></path></svg><span>Fork</span></a></div><button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 size-9 h-9 w-9"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun h-4 w-4"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg></button><div class="md:hidden"><button class="inline-flex items-center justify-center rounded-md p-2 text-muted-foreground hover:text-foreground hover:bg-secondary transition-colors" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-5 w-5"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button></div></div></div></header><div class="flex flex-1 overflow-hidden"><div class="w-64 shrink-0 border-r border-border/50 overflow-y-auto"><div class="flex flex-col h-full"><div class="p-3 border-b border-border/50"><div class="relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><input type="text" placeholder="Search docs..." class="w-full h-8 pl-8 pr-3 text-sm rounded-md border border-border bg-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring" value=""/></div></div><nav class="flex-1 overflow-y-auto p-2 space-y-0.5"><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" href="/docs/index/">Overview</a><div data-state="open" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-foreground font-medium" style="padding-left:12px" type="button" aria-controls="radix-_R_j6av5ubtb_" aria-expanded="true" data-state="open" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform rotate-90"><path d="m9 18 6-6-6-6"></path></svg>Guides</button><div data-state="open" id="radix-_R_j6av5ubtb_" data-slot="collapsible-content"><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/quickstart/">Quick Start</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/installation/">Installation</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/first-program/">Your First Program</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/core-concepts/">Data Modeling</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/repl/">REPL Guide</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/recursion/">Recursion</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors bg-primary/10 text-primary font-medium" style="padding-left:24px" href="/docs/guides/vectors/">Vector Search</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/indexing/">Indexing</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/temporal/">Temporal Reasoning</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/persistence/">Persistence</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/configuration/">Configuration</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/rest-api/">REST API</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/python-sdk/">Python SDK</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/deployment/">Deployment</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/authentication/">Authentication</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/websocket-api/">WebSocket API</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/migrations/">Migrations</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/troubleshooting/">Troubleshooting</a></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_r6av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Reference</button><div data-state="closed" id="radix-_R_r6av5ubtb_" hidden="" data-slot="collapsible-content"></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_136av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Specification</button><div data-state="closed" id="radix-_R_136av5ubtb_" hidden="" data-slot="collapsible-content"></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_1b6av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Internals</button><div data-state="closed" id="radix-_R_1b6av5ubtb_" hidden="" data-slot="collapsible-content"></div></div></nav></div></div><div class="flex flex-1 flex-col overflow-hidden"><div class="flex flex-1 overflow-hidden"><div class="flex-1 overflow-y-auto px-8 py-6 max-w-4xl mx-auto"><article class="docs-prose"><h1 id="vector-search-tutorial" node="[object Object]">Vector Search Tutorial</h1>
<p>Store embeddings alongside structured data. Query by cosine, euclidean, or dot-product similarity - no external vector DB needed.</p>
<h2 id="vector-basics" node="[object Object]">Vector Basics</h2>
<h3 id="storing-vectors" node="[object Object]">Storing Vectors</h3>
<p>Vectors are arrays of floating-point numbers, typically embeddings from ML models:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Store document embeddings</span>
<span class="syn-arith">+</span><span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-number">1</span><span class="syn-punct">,</span> <span class="syn-string">"Introduction to Datalog"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.1</span><span class="syn-punct">,</span> <span class="syn-number">0.2</span><span class="syn-punct">,</span> <span class="syn-number">0.3</span><span class="syn-punct">,</span> <span class="syn-number">0.4</span><span class="syn-punct">]</span><span class="syn-punct">)</span>
<span class="syn-arith">+</span><span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-number">2</span><span class="syn-punct">,</span> <span class="syn-string">"Vector Similarity"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.15</span><span class="syn-punct">,</span> <span class="syn-number">0.25</span><span class="syn-punct">,</span> <span class="syn-number">0.28</span><span class="syn-punct">,</span> <span class="syn-number">0.42</span><span class="syn-punct">]</span><span class="syn-punct">)</span>
<span class="syn-arith">+</span><span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-number">3</span><span class="syn-punct">,</span> <span class="syn-string">"Graph Databases"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.8</span><span class="syn-punct">,</span> <span class="syn-number">0.1</span><span class="syn-punct">,</span> <span class="syn-number">0.05</span><span class="syn-punct">,</span> <span class="syn-number">0.05</span><span class="syn-punct">]</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="schema-with-vectors" node="[object Object]">Schema with Vectors</h3>
<p>Declare vector columns in your schema:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-identifier">id</span><span class="syn-punct">:</span> <span class="syn-keyword">int</span><span class="syn-punct">,</span> <span class="syn-identifier">title</span><span class="syn-punct">:</span> <span class="syn-keyword">string</span><span class="syn-punct">,</span> <span class="syn-identifier">embedding</span><span class="syn-punct">:</span> <span class="syn-keyword">vector</span><span class="syn-punct">)</span>
</code></pre>
<hr/>
<h2 id="distance-functions" node="[object Object]">Distance Functions</h2>
<p>InputLayer supports 4 distance metrics:</p>
<h3 id="euclidean-distance" node="[object Object]">Euclidean Distance</h3>
<p>L2 distance - straight-line distance in vector space:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id1</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V1</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id2</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V2</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Id1</span> <span class="syn-comparison">&lt;</span> <span class="syn-variable">Id2</span><span class="syn-punct">,</span>
   <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">euclidean</span><span class="syn-punct">(</span><span class="syn-variable">V1</span><span class="syn-punct">,</span> <span class="syn-variable">V2</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="cosine-distance" node="[object Object]">Cosine Distance</h3>
<p>Angular distance (1 - cosine similarity) - ignores magnitude:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id1</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V1</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id2</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V2</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Id1</span> <span class="syn-comparison">&lt;</span> <span class="syn-variable">Id2</span><span class="syn-punct">,</span>
   <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">cosine</span><span class="syn-punct">(</span><span class="syn-variable">V1</span><span class="syn-punct">,</span> <span class="syn-variable">V2</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Use cosine for:</strong> Text embeddings, normalized vectors</p>
<h3 id="dot-product" node="[object Object]">Dot Product</h3>
<p>Inner product - higher is more similar:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id1</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V1</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id2</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V2</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Id1</span> <span class="syn-comparison">&lt;</span> <span class="syn-variable">Id2</span><span class="syn-punct">,</span>
   <span class="syn-variable">Score</span> <span class="syn-comparison">=</span> <span class="syn-builtin">dot</span><span class="syn-punct">(</span><span class="syn-variable">V1</span><span class="syn-punct">,</span> <span class="syn-variable">V2</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Use dot product for:</strong> When vectors have meaningful magnitude</p>
<h3 id="manhattan-distance" node="[object Object]">Manhattan Distance</h3>
<p>L1 distance - sum of absolute differences:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id1</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V1</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id2</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V2</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Id1</span> <span class="syn-comparison">&lt;</span> <span class="syn-variable">Id2</span><span class="syn-punct">,</span>
   <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">manhattan</span><span class="syn-punct">(</span><span class="syn-variable">V1</span><span class="syn-punct">,</span> <span class="syn-variable">V2</span><span class="syn-punct">)</span>
</code></pre>
<hr/>
<h2 id="semantic-search-example" node="[object Object]">Semantic Search Example</h2>
<p>Build a document search system:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Store documents with embeddings</span>
<span class="syn-arith">+</span><span class="syn-identifier">docs</span><span class="syn-punct">[</span><span class="syn-punct">(</span><span class="syn-number">1</span><span class="syn-punct">,</span> <span class="syn-string">"Introduction to Datalog"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.1</span><span class="syn-punct">,</span> <span class="syn-number">0.2</span><span class="syn-punct">,</span> <span class="syn-number">0.3</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
      <span class="syn-punct">(</span><span class="syn-number">2</span><span class="syn-punct">,</span> <span class="syn-string">"Vector Databases"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.12</span><span class="syn-punct">,</span> <span class="syn-number">0.22</span><span class="syn-punct">,</span> <span class="syn-number">0.31</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
      <span class="syn-punct">(</span><span class="syn-number">3</span><span class="syn-punct">,</span> <span class="syn-string">"Graph Theory"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.8</span><span class="syn-punct">,</span> <span class="syn-number">0.1</span><span class="syn-punct">,</span> <span class="syn-number">0.05</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
      <span class="syn-punct">(</span><span class="syn-number">4</span><span class="syn-punct">,</span> <span class="syn-string">"Machine Learning"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.15</span><span class="syn-punct">,</span> <span class="syn-number">0.18</span><span class="syn-punct">,</span> <span class="syn-number">0.28</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">]</span>

<span class="syn-comment">// Query vector (from your embedding model)</span>
<span class="syn-identifier">query_vec</span><span class="syn-punct">(</span><span class="syn-punct">[</span><span class="syn-number">0.11</span><span class="syn-punct">,</span> <span class="syn-number">0.21</span><span class="syn-punct">,</span> <span class="syn-number">0.29</span><span class="syn-punct">]</span><span class="syn-punct">)</span>

<span class="syn-comment">// Find similar documents</span>
<span class="syn-arith">+</span><span class="syn-identifier">similar</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Title</span><span class="syn-punct">,</span> <span class="syn-aggregate">top_k</span><span class="syn-comparison">&lt;</span><span class="syn-number">3</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">query_vec</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">docs</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Title</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">cosine</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>

<span class="syn-query">?</span> <span class="syn-identifier">similar</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Title</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Output:</strong></p>
<div class="my-4 overflow-x-auto"><table class="w-full border-collapse" node="[object Object]"><thead><tr><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Id</th><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Title</th><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Dist</th></tr></thead><tbody><tr><td class="border px-4 py-2" node="[object Object]">1</td><td class="border px-4 py-2" node="[object Object]">&quot;Introduction to Datalog&quot;</td><td class="border px-4 py-2" node="[object Object]">0.002</td></tr><tr><td class="border px-4 py-2" node="[object Object]">2</td><td class="border px-4 py-2" node="[object Object]">&quot;Vector Databases&quot;</td><td class="border px-4 py-2" node="[object Object]">0.003</td></tr><tr><td class="border px-4 py-2" node="[object Object]">4</td><td class="border px-4 py-2" node="[object Object]">&quot;Machine Learning&quot;</td><td class="border px-4 py-2" node="[object Object]">0.015</td></tr></tbody></table></div>
<p><em>3 rows</em></p>
<hr/>
<h2 id="vector-operations" node="[object Object]">Vector Operations</h2>
<h3 id="normalize" node="[object Object]">Normalize</h3>
<p>Convert to unit vector (length 1):</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">NormV</span> <span class="syn-comparison">=</span> <span class="syn-builtin">normalize</span><span class="syn-punct">(</span><span class="syn-variable">V</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="get-dimension" node="[object Object]">Get Dimension</h3>
<p>Get the number of elements:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Dim</span> <span class="syn-comparison">=</span> <span class="syn-builtin">vec_dim</span><span class="syn-punct">(</span><span class="syn-variable">V</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="add-vectors" node="[object Object]">Add Vectors</h3>
<p>Element-wise addition:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">v1</span><span class="syn-punct">(</span><span class="syn-punct">[</span><span class="syn-number">1.0</span><span class="syn-punct">,</span> <span class="syn-number">2.0</span><span class="syn-punct">,</span> <span class="syn-number">3.0</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-identifier">v2</span><span class="syn-punct">(</span><span class="syn-punct">[</span><span class="syn-number">0.5</span><span class="syn-punct">,</span> <span class="syn-number">0.5</span><span class="syn-punct">,</span> <span class="syn-number">0.5</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Sum</span> <span class="syn-comparison">=</span> <span class="syn-builtin">vec_add</span><span class="syn-punct">(</span><span class="syn-variable">V1</span><span class="syn-punct">,</span> <span class="syn-variable">V2</span><span class="syn-punct">)</span>  <span class="syn-comment">// [1.5, 2.5, 3.5]</span>
</code></pre>
<h3 id="scale-vector" node="[object Object]">Scale Vector</h3>
<p>Multiply by scalar:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">v</span><span class="syn-punct">(</span><span class="syn-punct">[</span><span class="syn-number">1.0</span><span class="syn-punct">,</span> <span class="syn-number">2.0</span><span class="syn-punct">,</span> <span class="syn-number">3.0</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Scaled</span> <span class="syn-comparison">=</span> <span class="syn-builtin">vec_scale</span><span class="syn-punct">(</span><span class="syn-variable">V</span><span class="syn-punct">,</span> <span class="syn-number">2.0</span><span class="syn-punct">)</span>  <span class="syn-comment">// [2.0, 4.0, 6.0]</span>
</code></pre>
<hr/>
<h2 id="lsh-locality-sensitive-hashing" node="[object Object]">LSH (Locality Sensitive Hashing)</h2>
<p>For approximate nearest neighbor search on large datasets:</p>
<h3 id="basic-lsh-bucket" node="[object Object]">Basic LSH Bucket</h3>
<p>Hash vectors into buckets:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">document</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Bucket</span> <span class="syn-comparison">=</span> <span class="syn-builtin">lsh_bucket</span><span class="syn-punct">(</span><span class="syn-variable">V</span><span class="syn-punct">,</span> <span class="syn-number">0</span><span class="syn-punct">,</span> <span class="syn-number">8</span><span class="syn-punct">)</span>  <span class="syn-comment">// table 0, 8 hyperplanes</span>
</code></pre>
<h3 id="lsh-probes" node="[object Object]">LSH Probes</h3>
<p>Get multiple candidate buckets to check:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">query_vec</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Buckets</span> <span class="syn-comparison">=</span> <span class="syn-builtin">lsh_probes</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-number">0</span><span class="syn-punct">,</span> <span class="syn-number">8</span><span class="syn-punct">,</span> <span class="syn-number">3</span><span class="syn-punct">)</span>  <span class="syn-comment">// 3 probe levels</span>
</code></pre>
<h3 id="lsh-multi-probe-search" node="[object Object]">LSH Multi-Probe Search</h3>
<p>Full multi-probe search:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">candidates</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">query_vec</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-variable">Probes</span> <span class="syn-comparison">=</span> <span class="syn-builtin">lsh_multi_probe</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-number">0</span><span class="syn-punct">,</span> <span class="syn-number">8</span><span class="syn-punct">,</span> <span class="syn-number">3</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">member</span><span class="syn-punct">(</span><span class="syn-variable">Bucket</span><span class="syn-punct">,</span> <span class="syn-variable">Probes</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">document</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-builtin">lsh_bucket</span><span class="syn-punct">(</span><span class="syn-variable">V</span><span class="syn-punct">,</span> <span class="syn-number">0</span><span class="syn-punct">,</span> <span class="syn-number">8</span><span class="syn-punct">)</span> <span class="syn-comparison">=</span> <span class="syn-variable">Bucket</span><span class="syn-punct">,</span>
    <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">cosine</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>
</code></pre>
<hr/>
<h2 id="int8-quantization" node="[object Object]">Int8 Quantization</h2>
<p>Reduce memory by 75% using 8-bit quantization:</p>
<h3 id="quantize-vectors" node="[object Object]">Quantize Vectors</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Linear quantization (uniform distribution)</span>
<span class="syn-arith">+</span><span class="syn-identifier">quantized</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-builtin">quantize_linear</span><span class="syn-punct">(</span><span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">document</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>

<span class="syn-comment">// Symmetric quantization (centered at 0)</span>
<span class="syn-arith">+</span><span class="syn-identifier">quantized</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-builtin">quantize_symmetric</span><span class="syn-punct">(</span><span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">document</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="dequantize" node="[object Object]">Dequantize</h3>
<p>Convert back to float:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">quantized</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">V</span> <span class="syn-comparison">=</span> <span class="syn-builtin">dequantize</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="int8-distance-functions" node="[object Object]">Int8 Distance Functions</h3>
<p>Direct computation on quantized vectors:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-query">?</span> <span class="syn-identifier">quantized</span><span class="syn-punct">(</span><span class="syn-variable">Id1</span><span class="syn-punct">,</span> <span class="syn-variable">QV1</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-identifier">quantized</span><span class="syn-punct">(</span><span class="syn-variable">Id2</span><span class="syn-punct">,</span> <span class="syn-variable">QV2</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
   <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">euclidean_int8</span><span class="syn-punct">(</span><span class="syn-variable">QV1</span><span class="syn-punct">,</span> <span class="syn-variable">QV2</span><span class="syn-punct">)</span>

<span class="syn-comment">// Also available: cosine_int8, dot_int8, manhattan_int8</span>
</code></pre>
<hr/>
<h2 id="building-a-recommendation-system" node="[object Object]">Building a Recommendation System</h2>
<p>Complete example for item recommendations:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Item embeddings (from your ML model)</span>
<span class="syn-arith">+</span><span class="syn-identifier">items</span><span class="syn-punct">[</span><span class="syn-punct">(</span><span class="syn-number">1</span><span class="syn-punct">,</span> <span class="syn-string">"Blue T-Shirt"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.2</span><span class="syn-punct">,</span> <span class="syn-number">0.8</span><span class="syn-punct">,</span> <span class="syn-number">0.1</span><span class="syn-punct">,</span> <span class="syn-number">0.3</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
       <span class="syn-punct">(</span><span class="syn-number">2</span><span class="syn-punct">,</span> <span class="syn-string">"Red Dress"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.25</span><span class="syn-punct">,</span> <span class="syn-number">0.75</span><span class="syn-punct">,</span> <span class="syn-number">0.15</span><span class="syn-punct">,</span> <span class="syn-number">0.35</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
       <span class="syn-punct">(</span><span class="syn-number">3</span><span class="syn-punct">,</span> <span class="syn-string">"Running Shoes"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.9</span><span class="syn-punct">,</span> <span class="syn-number">0.1</span><span class="syn-punct">,</span> <span class="syn-number">0.8</span><span class="syn-punct">,</span> <span class="syn-number">0.2</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
       <span class="syn-punct">(</span><span class="syn-number">4</span><span class="syn-punct">,</span> <span class="syn-string">"Hiking Boots"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.85</span><span class="syn-punct">,</span> <span class="syn-number">0.15</span><span class="syn-punct">,</span> <span class="syn-number">0.75</span><span class="syn-punct">,</span> <span class="syn-number">0.25</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
       <span class="syn-punct">(</span><span class="syn-number">5</span><span class="syn-punct">,</span> <span class="syn-string">"Formal Shoes"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.4</span><span class="syn-punct">,</span> <span class="syn-number">0.6</span><span class="syn-punct">,</span> <span class="syn-number">0.3</span><span class="syn-punct">,</span> <span class="syn-number">0.5</span><span class="syn-punct">]</span><span class="syn-punct">)</span><span class="syn-punct">]</span>

<span class="syn-comment">// User purchase history (for creating user profile)</span>
<span class="syn-arith">+</span><span class="syn-identifier">purchases</span><span class="syn-punct">[</span><span class="syn-punct">(</span><span class="syn-number">101</span><span class="syn-punct">,</span> <span class="syn-number">1</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-number">101</span><span class="syn-punct">,</span> <span class="syn-number">2</span><span class="syn-punct">)</span><span class="syn-punct">,</span>    <span class="syn-comment">// User 101 bought shirts &amp; dresses</span>
           <span class="syn-punct">(</span><span class="syn-number">102</span><span class="syn-punct">,</span> <span class="syn-number">3</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-punct">(</span><span class="syn-number">102</span><span class="syn-punct">,</span> <span class="syn-number">4</span><span class="syn-punct">)</span><span class="syn-punct">]</span>    <span class="syn-comment">// User 102 bought athletic footwear</span>

<span class="syn-comment">// Compute user profile as average of purchased item embeddings</span>
<span class="syn-arith">+</span><span class="syn-identifier">user_profile</span><span class="syn-punct">(</span><span class="syn-variable">UserId</span><span class="syn-punct">,</span> <span class="syn-aggregate">avg</span><span class="syn-comparison">&lt;</span><span class="syn-variable">V</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">purchases</span><span class="syn-punct">(</span><span class="syn-variable">UserId</span><span class="syn-punct">,</span> <span class="syn-variable">ItemId</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">items</span><span class="syn-punct">(</span><span class="syn-variable">ItemId</span><span class="syn-punct">,</span> <span class="syn-variable">_</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>

<span class="syn-comment">// Recommend items similar to user profile, excluding already purchased</span>
<span class="syn-arith">+</span><span class="syn-identifier">recommendations</span><span class="syn-punct">(</span><span class="syn-variable">UserId</span><span class="syn-punct">,</span> <span class="syn-variable">ItemId</span><span class="syn-punct">,</span> <span class="syn-variable">Name</span><span class="syn-punct">,</span> <span class="syn-aggregate">top_k</span><span class="syn-comparison">&lt;</span><span class="syn-number">3</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-comparison">&gt;</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">user_profile</span><span class="syn-punct">(</span><span class="syn-variable">UserId</span><span class="syn-punct">,</span> <span class="syn-variable">Profile</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">items</span><span class="syn-punct">(</span><span class="syn-variable">ItemId</span><span class="syn-punct">,</span> <span class="syn-variable">Name</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-negation">!</span><span class="syn-body-id">purchases</span><span class="syn-punct">(</span><span class="syn-variable">UserId</span><span class="syn-punct">,</span> <span class="syn-variable">ItemId</span><span class="syn-punct">)</span><span class="syn-punct">,</span>  <span class="syn-comment">// Exclude already purchased</span>
    <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">cosine</span><span class="syn-punct">(</span><span class="syn-variable">Profile</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>

<span class="syn-comment">// Get recommendations for user 101</span>
<span class="syn-query">?</span> <span class="syn-identifier">recommendations</span><span class="syn-punct">(</span><span class="syn-number">101</span><span class="syn-punct">,</span> <span class="syn-variable">ItemId</span><span class="syn-punct">,</span> <span class="syn-variable">Name</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-punct">)</span>
</code></pre>
<hr/>
<h2 id="performance-tips" node="[object Object]">Performance Tips</h2>
<h3 id="1-use-appropriate-distance-metric" node="[object Object]">1. Use Appropriate Distance Metric</h3>
<div class="my-4 overflow-x-auto"><table class="w-full border-collapse" node="[object Object]"><thead><tr><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Embedding Type</th><th class="border px-4 py-2 text-left font-semibold bg-muted/50" node="[object Object]">Recommended Metric</th></tr></thead><tbody><tr><td class="border px-4 py-2" node="[object Object]">Text (BERT, etc.)</td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">cosine</code></td></tr><tr><td class="border px-4 py-2" node="[object Object]">Images</td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">euclidean</code> or <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">cosine</code></td></tr><tr><td class="border px-4 py-2" node="[object Object]">Normalized</td><td class="border px-4 py-2" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">dot</code> (fastest)</td></tr></tbody></table></div>
<h3 id="2-create-hnsw-indexes" node="[object Object]">2. Create HNSW Indexes</h3>
<p>For large datasets (&gt;10K vectors):</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">.index create doc_idx on documents(embedding) metric cosine m 16 ef_construction 200 ef_search 50
</code></pre>
<h3 id="2b-query-hnsw-indexes" node="[object Object]">2b. Query HNSW Indexes</h3>
<p>Use <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">hnsw_nearest()</code> in query bodies to perform fast approximate nearest-neighbor search:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Find 5 nearest neighbors</span>
<span class="syn-query">?</span> <span class="syn-builtin">hnsw_nearest</span><span class="syn-punct">(</span><span class="syn-string">"doc_idx"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.1</span><span class="syn-punct">,</span> <span class="syn-number">0.2</span><span class="syn-punct">,</span> <span class="syn-number">0.3</span><span class="syn-punct">]</span><span class="syn-punct">,</span> <span class="syn-number">5</span><span class="syn-punct">,</span> <span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-punct">)</span>

<span class="syn-comment">// Use with a bound query vector</span>
<span class="syn-query">?</span> <span class="syn-identifier">query_vec</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span> <span class="syn-builtin">hnsw_nearest</span><span class="syn-punct">(</span><span class="syn-string">"doc_idx"</span><span class="syn-punct">,</span> <span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-number">10</span><span class="syn-punct">,</span> <span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-punct">)</span>

<span class="syn-comment">// Override ef_search for higher recall</span>
<span class="syn-query">?</span> <span class="syn-builtin">hnsw_nearest</span><span class="syn-punct">(</span><span class="syn-string">"doc_idx"</span><span class="syn-punct">,</span> <span class="syn-punct">[</span><span class="syn-number">0.1</span><span class="syn-punct">,</span> <span class="syn-number">0.2</span><span class="syn-punct">,</span> <span class="syn-number">0.3</span><span class="syn-punct">]</span><span class="syn-punct">,</span> <span class="syn-number">5</span><span class="syn-punct">,</span> <span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-punct">,</span> <span class="syn-number">200</span><span class="syn-punct">)</span>
</code></pre>
<p><strong>Syntax:</strong> <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">hnsw_nearest(&quot;index_name&quot;, QueryVec, K, IdVar, DistVar [, EfSearch])</code></p>
<ul>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">index_name</code> - String literal naming the HNSW index</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">QueryVec</code> - Variable bound to a vector, or a vector literal</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">K</code> - Integer: number of neighbors to return</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">IdVar</code> - Variable to bind result IDs</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">DistVar</code> - Variable to bind distances</li>
<li><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">EfSearch</code> - Optional integer: override ef_search for this query</li>
</ul>
<h3 id="3-use-quantization-for-memory" node="[object Object]">3. Use Quantization for Memory</h3>
<p>For millions of vectors, quantize to Int8:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-arith">+</span><span class="syn-identifier">docs_quantized</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Title</span><span class="syn-punct">,</span> <span class="syn-builtin">quantize_symmetric</span><span class="syn-punct">(</span><span class="syn-variable">V</span><span class="syn-punct">)</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span> <span class="syn-body-id">docs</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Title</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>
</code></pre>
<h3 id="4-filter-before-distance-computation" node="[object Object]">4. Filter Before Distance Computation</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-datalog text-sm"><span class="syn-comment">// Filter first, then compute distances</span>
<span class="syn-arith">+</span><span class="syn-identifier">similar</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Title</span><span class="syn-punct">,</span> <span class="syn-variable">Dist</span><span class="syn-punct">)</span> <span class="syn-arrow">&lt;-</span>
    <span class="syn-body-id">query_vec</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-body-id">docs</span><span class="syn-punct">(</span><span class="syn-variable">Id</span><span class="syn-punct">,</span> <span class="syn-variable">Title</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">,</span> <span class="syn-variable">Category</span><span class="syn-punct">)</span><span class="syn-punct">,</span>
    <span class="syn-variable">Category</span> <span class="syn-comparison">=</span> <span class="syn-string">"technology"</span><span class="syn-punct">,</span>     <span class="syn-comment">// Filter first</span>
    <span class="syn-variable">Dist</span> <span class="syn-comparison">=</span> <span class="syn-builtin">cosine</span><span class="syn-punct">(</span><span class="syn-variable">QV</span><span class="syn-punct">,</span> <span class="syn-variable">V</span><span class="syn-punct">)</span>         <span class="syn-comment">// Then compute distance</span>
</code></pre>
<hr/>
<h2 id="next-steps" node="[object Object]">Next Steps</h2>
<ul>
<li><a href="indexing" target="_blank" rel="noopener noreferrer" node="[object Object]">Indexing Guide</a> - Create HNSW indexes for fast search</li>
<li><a href="temporal" target="_blank" rel="noopener noreferrer" node="[object Object]">Temporal Functions</a> - Add time-decay to recommendations</li>
</ul></article></div><div class="hidden lg:block w-48 shrink-0 border-l border-border/50"><div class="sticky top-0 p-4"><p class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3">On this page</p><nav class="space-y-1"><a href="#vector-basics" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Vector Basics</a><a href="#storing-vectors" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Storing Vectors</a><a href="#schema-with-vectors" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Schema with Vectors</a><a href="#distance-functions" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Distance Functions</a><a href="#euclidean-distance" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Euclidean Distance</a><a href="#cosine-distance" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Cosine Distance</a><a href="#dot-product" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Dot Product</a><a href="#manhattan-distance" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Manhattan Distance</a><a href="#semantic-search-example" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Semantic Search Example</a><a href="#vector-operations" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Vector Operations</a><a href="#normalize" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Normalize</a><a href="#get-dimension" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Get Dimension</a><a href="#add-vectors" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Add Vectors</a><a href="#scale-vector" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Scale Vector</a><a href="#lsh-locality-sensitive-hashing" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">LSH (Locality Sensitive Hashing)</a><a href="#basic-lsh-bucket" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Basic LSH Bucket</a><a href="#lsh-probes" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">LSH Probes</a><a href="#lsh-multi-probe-search" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">LSH Multi-Probe Search</a><a href="#int8-quantization" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Int8 Quantization</a><a href="#quantize-vectors" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Quantize Vectors</a><a href="#dequantize" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Dequantize</a><a href="#int8-distance-functions" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Int8 Distance Functions</a><a href="#building-a-recommendation-system" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Building a Recommendation System</a><a href="#performance-tips" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Performance Tips</a><a href="#1-use-appropriate-distance-metric" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">1. Use Appropriate Distance Metric</a><a href="#2-create-hnsw-indexes" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">2. Create HNSW Indexes</a><a href="#2b-query-hnsw-indexes" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">2b. Query HNSW Indexes</a><a href="#3-use-quantization-for-memory" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">3. Use Quantization for Memory</a><a href="#4-filter-before-distance-computation" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">4. Filter Before Distance Computation</a><a href="#next-steps" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Next Steps</a></nav></div></div></div></div></div></div><!--$--><!--/$--><script src="/_next/static/chunks/webpack-bd6546b43ab2ecbf.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1942,[\"177\",\"static/chunks/app/layout-7e9963bf811be36b.js\"],\"ThemeProvider\"]\n3:I[7121,[],\"\"]\n4:I[4581,[],\"\"]\n6:I[484,[],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[484,[],\"ViewportBoundary\"]\nb:I[484,[],\"MetadataBoundary\"]\nd:I[7123,[],\"\"]\n:HL[\"/_next/static/media/4cf2300e9c8272f7-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/4bd7a24b7976d4e6.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"05bjYGyiAumoEMBrfWHih\",\"c\":[\"\",\"docs\",\"guides\",\"vectors\",\"\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"guides/vectors\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4bd7a24b7976d4e6.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_188709 __variable_9a8899 font-sans antialiased\",\"children\":[\"$\",\"$L2\",null,{\"attribute\":\"class\",\"defaultTheme\":\"dark\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:I[8428,[\"758\",\"static/chunks/758-3cb69ce377cde046.js\",\"121\",\"static/chunks/121-aece4f809b101dc1.js\",\"502\",\"static/chunks/502-e809071f8789437b.js\",\"689\",\"static/chunks/689-4fcf9680fdc90283.js\",\"870\",\"static/chunks/app/docs/%5B%5B...slug%5D%5D/page-004ec69e3c86920a.js\"],\"DocsPageClient\"]\nf:T1b76,"])</script><script>self.__next_f.push([1,"# Vector Search Tutorial\n\nStore embeddings alongside structured data. Query by cosine, euclidean, or dot-product similarity - no external vector DB needed.\n\n## Vector Basics\n\n### Storing Vectors\n\nVectors are arrays of floating-point numbers, typically embeddings from ML models:\n\n```datalog\n// Store document embeddings\n+document(1, \"Introduction to Datalog\", [0.1, 0.2, 0.3, 0.4])\n+document(2, \"Vector Similarity\", [0.15, 0.25, 0.28, 0.42])\n+document(3, \"Graph Databases\", [0.8, 0.1, 0.05, 0.05])\n```\n\n### Schema with Vectors\n\nDeclare vector columns in your schema:\n\n```datalog\n+document(id: int, title: string, embedding: vector)\n```\n\n---\n\n## Distance Functions\n\nInputLayer supports 4 distance metrics:\n\n### Euclidean Distance\n\nL2 distance - straight-line distance in vector space:\n\n```datalog\n? document(Id1, _, V1), document(Id2, _, V2),\n   Id1 \u003c Id2,\n   Dist = euclidean(V1, V2)\n```\n\n### Cosine Distance\n\nAngular distance (1 - cosine similarity) - ignores magnitude:\n\n```datalog\n? document(Id1, _, V1), document(Id2, _, V2),\n   Id1 \u003c Id2,\n   Dist = cosine(V1, V2)\n```\n\n**Use cosine for:** Text embeddings, normalized vectors\n\n### Dot Product\n\nInner product - higher is more similar:\n\n```datalog\n? document(Id1, _, V1), document(Id2, _, V2),\n   Id1 \u003c Id2,\n   Score = dot(V1, V2)\n```\n\n**Use dot product for:** When vectors have meaningful magnitude\n\n### Manhattan Distance\n\nL1 distance - sum of absolute differences:\n\n```datalog\n? document(Id1, _, V1), document(Id2, _, V2),\n   Id1 \u003c Id2,\n   Dist = manhattan(V1, V2)\n```\n\n---\n\n## Semantic Search Example\n\nBuild a document search system:\n\n```datalog\n// Store documents with embeddings\n+docs[(1, \"Introduction to Datalog\", [0.1, 0.2, 0.3]),\n      (2, \"Vector Databases\", [0.12, 0.22, 0.31]),\n      (3, \"Graph Theory\", [0.8, 0.1, 0.05]),\n      (4, \"Machine Learning\", [0.15, 0.18, 0.28])]\n\n// Query vector (from your embedding model)\nquery_vec([0.11, 0.21, 0.29])\n\n// Find similar documents\n+similar(Id, Title, top_k\u003c3, Dist\u003e) \u003c-\n    query_vec(QV),\n    docs(Id, Title, V),\n    Dist = cosine(QV, V)\n\n? similar(Id, Title, Dist)\n```\n\n**Output:**\n\n| Id | Title | Dist |\n|---|---|---|\n| 1 | \"Introduction to Datalog\" | 0.002 |\n| 2 | \"Vector Databases\" | 0.003 |\n| 4 | \"Machine Learning\" | 0.015 |\n\n*3 rows*\n\n---\n\n## Vector Operations\n\n### Normalize\n\nConvert to unit vector (length 1):\n\n```datalog\n? document(Id, _, V),\n   NormV = normalize(V)\n```\n\n### Get Dimension\n\nGet the number of elements:\n\n```datalog\n? document(Id, _, V),\n   Dim = vec_dim(V)\n```\n\n### Add Vectors\n\nElement-wise addition:\n\n```datalog\n? v1([1.0, 2.0, 3.0]), v2([0.5, 0.5, 0.5]),\n   Sum = vec_add(V1, V2)  // [1.5, 2.5, 3.5]\n```\n\n### Scale Vector\n\nMultiply by scalar:\n\n```datalog\n? v([1.0, 2.0, 3.0]),\n   Scaled = vec_scale(V, 2.0)  // [2.0, 4.0, 6.0]\n```\n\n---\n\n## LSH (Locality Sensitive Hashing)\n\nFor approximate nearest neighbor search on large datasets:\n\n### Basic LSH Bucket\n\nHash vectors into buckets:\n\n```datalog\n? document(Id, _, V),\n   Bucket = lsh_bucket(V, 0, 8)  // table 0, 8 hyperplanes\n```\n\n### LSH Probes\n\nGet multiple candidate buckets to check:\n\n```datalog\n? query_vec(QV),\n   Buckets = lsh_probes(QV, 0, 8, 3)  // 3 probe levels\n```\n\n### LSH Multi-Probe Search\n\nFull multi-probe search:\n\n```datalog\n+candidates(Id, Dist) \u003c-\n    query_vec(QV),\n    Probes = lsh_multi_probe(QV, 0, 8, 3),\n    member(Bucket, Probes),\n    document(Id, _, V),\n    lsh_bucket(V, 0, 8) = Bucket,\n    Dist = cosine(QV, V)\n```\n\n---\n\n## Int8 Quantization\n\nReduce memory by 75% using 8-bit quantization:\n\n### Quantize Vectors\n\n```datalog\n// Linear quantization (uniform distribution)\n+quantized(Id, quantize_linear(V)) \u003c- document(Id, _, V)\n\n// Symmetric quantization (centered at 0)\n+quantized(Id, quantize_symmetric(V)) \u003c- document(Id, _, V)\n```\n\n### Dequantize\n\nConvert back to float:\n\n```datalog\n? quantized(Id, QV),\n   V = dequantize(QV)\n```\n\n### Int8 Distance Functions\n\nDirect computation on quantized vectors:\n\n```datalog\n? quantized(Id1, QV1), quantized(Id2, QV2),\n   Dist = euclidean_int8(QV1, QV2)\n\n// Also available: cosine_int8, dot_int8, manhattan_int8\n```\n\n---\n\n## Building a Recommendation System\n\nComplete example for item recommendations:\n\n```datalog\n// Item embeddings (from your ML model)\n+items[(1, \"Blue T-Shirt\", [0.2, 0.8, 0.1, 0.3]),\n       (2, \"Red Dress\", [0.25, 0.75, 0.15, 0.35]),\n       (3, \"Running Shoes\", [0.9, 0.1, 0.8, 0.2]),\n       (4, \"Hiking Boots\", [0.85, 0.15, 0.75, 0.25]),\n       (5, \"Formal Shoes\", [0.4, 0.6, 0.3, 0.5])]\n\n// User purchase history (for creating user profile)\n+purchases[(101, 1), (101, 2),    // User 101 bought shirts \u0026 dresses\n           (102, 3), (102, 4)]    // User 102 bought athletic footwear\n\n// Compute user profile as average of purchased item embeddings\n+user_profile(UserId, avg\u003cV\u003e) \u003c-\n    purchases(UserId, ItemId),\n    items(ItemId, _, V)\n\n// Recommend items similar to user profile, excluding already purchased\n+recommendations(UserId, ItemId, Name, top_k\u003c3, Dist\u003e) \u003c-\n    user_profile(UserId, Profile),\n    items(ItemId, Name, V),\n    !purchases(UserId, ItemId),  // Exclude already purchased\n    Dist = cosine(Profile, V)\n\n// Get recommendations for user 101\n? recommendations(101, ItemId, Name, Dist)\n```\n\n---\n\n## Performance Tips\n\n### 1. Use Appropriate Distance Metric\n\n| Embedding Type | Recommended Metric |\n|---------------|-------------------|\n| Text (BERT, etc.) | `cosine` |\n| Images | `euclidean` or `cosine` |\n| Normalized | `dot` (fastest) |\n\n### 2. Create HNSW Indexes\n\nFor large datasets (\u003e10K vectors):\n\n```\n.index create doc_idx on documents(embedding) metric cosine m 16 ef_construction 200 ef_search 50\n```\n\n### 2b. Query HNSW Indexes\n\nUse `hnsw_nearest()` in query bodies to perform fast approximate nearest-neighbor search:\n\n```datalog\n// Find 5 nearest neighbors\n? hnsw_nearest(\"doc_idx\", [0.1, 0.2, 0.3], 5, Id, Dist)\n\n// Use with a bound query vector\n? query_vec(QV), hnsw_nearest(\"doc_idx\", QV, 10, Id, Dist)\n\n// Override ef_search for higher recall\n? hnsw_nearest(\"doc_idx\", [0.1, 0.2, 0.3], 5, Id, Dist, 200)\n```\n\n**Syntax:** `hnsw_nearest(\"index_name\", QueryVec, K, IdVar, DistVar [, EfSearch])`\n- `index_name` - String literal naming the HNSW index\n- `QueryVec` - Variable bound to a vector, or a vector literal\n- `K` - Integer: number of neighbors to return\n- `IdVar` - Variable to bind result IDs\n- `DistVar` - Variable to bind distances\n- `EfSearch` - Optional integer: override ef_search for this query\n\n### 3. Use Quantization for Memory\n\nFor millions of vectors, quantize to Int8:\n\n```datalog\n+docs_quantized(Id, Title, quantize_symmetric(V)) \u003c- docs(Id, Title, V)\n```\n\n### 4. Filter Before Distance Computation\n\n```datalog\n// Filter first, then compute distances\n+similar(Id, Title, Dist) \u003c-\n    query_vec(QV),\n    docs(Id, Title, V, Category),\n    Category = \"technology\",     // Filter first\n    Dist = cosine(QV, V)         // Then compute distance\n```\n\n---\n\n## Next Steps\n\n- [Indexing Guide](indexing) - Create HNSW indexes for fast search\n- [Temporal Functions](temporal) - Add time-decay to recommendations"])</script><script>self.__next_f.push([1,"5:[\"$\",\"$Le\",null,{\"page\":{\"title\":\"Vector Search Tutorial\",\"content\":\"$f\",\"toc\":[{\"level\":2,\"text\":\"Vector Basics\",\"id\":\"vector-basics\"},{\"level\":3,\"text\":\"Storing Vectors\",\"id\":\"storing-vectors\"},{\"level\":3,\"text\":\"Schema with Vectors\",\"id\":\"schema-with-vectors\"},{\"level\":2,\"text\":\"Distance Functions\",\"id\":\"distance-functions\"},{\"level\":3,\"text\":\"Euclidean Distance\",\"id\":\"euclidean-distance\"},{\"level\":3,\"text\":\"Cosine Distance\",\"id\":\"cosine-distance\"},{\"level\":3,\"text\":\"Dot Product\",\"id\":\"dot-product\"},{\"level\":3,\"text\":\"Manhattan Distance\",\"id\":\"manhattan-distance\"},{\"level\":2,\"text\":\"Semantic Search Example\",\"id\":\"semantic-search-example\"},{\"level\":2,\"text\":\"Vector Operations\",\"id\":\"vector-operations\"},{\"level\":3,\"text\":\"Normalize\",\"id\":\"normalize\"},{\"level\":3,\"text\":\"Get Dimension\",\"id\":\"get-dimension\"},{\"level\":3,\"text\":\"Add Vectors\",\"id\":\"add-vectors\"},{\"level\":3,\"text\":\"Scale Vector\",\"id\":\"scale-vector\"},{\"level\":2,\"text\":\"LSH (Locality Sensitive Hashing)\",\"id\":\"lsh-locality-sensitive-hashing\"},{\"level\":3,\"text\":\"Basic LSH Bucket\",\"id\":\"basic-lsh-bucket\"},{\"level\":3,\"text\":\"LSH Probes\",\"id\":\"lsh-probes\"},{\"level\":3,\"text\":\"LSH Multi-Probe Search\",\"id\":\"lsh-multi-probe-search\"},{\"level\":2,\"text\":\"Int8 Quantization\",\"id\":\"int8-quantization\"},{\"level\":3,\"text\":\"Quantize Vectors\",\"id\":\"quantize-vectors\"},{\"level\":3,\"text\":\"Dequantize\",\"id\":\"dequantize\"},{\"level\":3,\"text\":\"Int8 Distance Functions\",\"id\":\"int8-distance-functions\"},{\"level\":2,\"text\":\"Building a Recommendation System\",\"id\":\"building-a-recommendation-system\"},{\"level\":2,\"text\":\"Performance Tips\",\"id\":\"performance-tips\"},{\"level\":3,\"text\":\"1. Use Appropriate Distance Metric\",\"id\":\"1-use-appropriate-distance-metric\"},{\"level\":3,\"text\":\"2. Create HNSW Indexes\",\"id\":\"2-create-hnsw-indexes\"},{\"level\":3,\"text\":\"2b. Query HNSW Indexes\",\"id\":\"2b-query-hnsw-indexes\"},{\"level\":3,\"text\":\"3. Use Quantization for Memory\",\"id\":\"3-use-quantization-for-memory\"},{\"level\":3,\"text\":\"4. Filter Before Distance Computation\",\"id\":\"4-filter-before-distance-computation\"},{\"level\":2,\"text\":\"Next Steps\",\"id\":\"next-steps\"}]},\"slugKey\":\"guides/vectors\"}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"10:I[6869,[],\"IconMark\"]\nc:[[\"$\",\"title\",\"0\",{\"children\":\"InputLayer - A symbolic reasoning engine for AI agents\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Store facts, define rules, and derive everything that logically follows. Vector search, graph traversal, and incremental computation in one system.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/icon.svg\"}],[\"$\",\"$L10\",\"3\",{}]]\n8:null\n"])</script></body></html>