<!DOCTYPE html><!--05bjYGyiAumoEMBrfWHih--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/4cf2300e9c8272f7-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/4bd7a24b7976d4e6.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-bd6546b43ab2ecbf.js"/><script src="/_next/static/chunks/4bd1b696-deba172d32c79f82.js" async=""></script><script src="/_next/static/chunks/794-275dc9ebd3a29fbf.js" async=""></script><script src="/_next/static/chunks/main-app-1fa5b694e5d36a75.js" async=""></script><script src="/_next/static/chunks/app/layout-7e9963bf811be36b.js" async=""></script><script src="/_next/static/chunks/758-3cb69ce377cde046.js" async=""></script><script src="/_next/static/chunks/121-aece4f809b101dc1.js" async=""></script><script src="/_next/static/chunks/502-e809071f8789437b.js" async=""></script><script src="/_next/static/chunks/689-4fcf9680fdc90283.js" async=""></script><script src="/_next/static/chunks/app/docs/%5B%5B...slug%5D%5D/page-004ec69e3c86920a.js" async=""></script><meta name="next-size-adjust" content=""/><title>InputLayer - A symbolic reasoning engine for AI agents</title><meta name="description" content="Store facts, define rules, and derive everything that logically follows. Vector search, graph traversal, and incremental computation in one system."/><link rel="icon" href="/icon.svg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_188709 __variable_9a8899 font-sans antialiased"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","dark",null,["light","dark"],null,true,true)</script><div class="flex flex-col h-dvh"><header class="sticky top-0 z-50 w-full border-b border-border/50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"><div class="flex h-14 items-center px-6"><a class="mr-8" href="/"><span class="inline-flex items-center gap-1.5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg><span class="font-extrabold tracking-tight text-lg">InputLayer</span></span></a><nav class="hidden md:flex items-center gap-6 text-sm"><a class="text-muted-foreground transition-colors hover:text-foreground" href="/docs/">Docs</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/blog/">Blog</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/use-cases/">Use Cases</a><a class="text-muted-foreground transition-colors hover:text-foreground" href="/compare/">Compare</a><a href="https://demo.inputlayer.ai" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 text-muted-foreground transition-colors hover:text-foreground">Demo<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link h-3 w-3"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg></a></nav><div class="ml-auto flex items-center gap-3"><div class="inline-flex items-center gap-1.5"><a href="https://github.com/inputlayer/inputlayer" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 rounded-md border border-border bg-secondary/50 px-2.5 py-1 text-xs font-medium text-muted-foreground transition-colors hover:text-foreground hover:bg-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star h-3.5 w-3.5"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"></path></svg><span>Star</span></a><a href="https://github.com/inputlayer/inputlayer/fork" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 rounded-md border border-border bg-secondary/50 px-2.5 py-1 text-xs font-medium text-muted-foreground transition-colors hover:text-foreground hover:bg-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-git-fork h-3.5 w-3.5"><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path><path d="M12 12v3"></path></svg><span>Fork</span></a></div><button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 size-9 h-9 w-9"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun h-4 w-4"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg></button><div class="md:hidden"><button class="inline-flex items-center justify-center rounded-md p-2 text-muted-foreground hover:text-foreground hover:bg-secondary transition-colors" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-5 w-5"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button></div></div></div></header><div class="flex flex-1 overflow-hidden"><div class="w-64 shrink-0 border-r border-border/50 overflow-y-auto"><div class="flex flex-col h-full"><div class="p-3 border-b border-border/50"><div class="relative"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><input type="text" placeholder="Search docs..." class="w-full h-8 pl-8 pr-3 text-sm rounded-md border border-border bg-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring" value=""/></div></div><nav class="flex-1 overflow-y-auto p-2 space-y-0.5"><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" href="/docs/index/">Overview</a><div data-state="open" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-foreground font-medium" style="padding-left:12px" type="button" aria-controls="radix-_R_j6av5ubtb_" aria-expanded="true" data-state="open" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform rotate-90"><path d="m9 18 6-6-6-6"></path></svg>Guides</button><div data-state="open" id="radix-_R_j6av5ubtb_" data-slot="collapsible-content"><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/quickstart/">Quick Start</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/installation/">Installation</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/first-program/">Your First Program</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/core-concepts/">Data Modeling</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/repl/">REPL Guide</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/recursion/">Recursion</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/vectors/">Vector Search</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/indexing/">Indexing</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/temporal/">Temporal Reasoning</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/persistence/">Persistence</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/configuration/">Configuration</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/rest-api/">REST API</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/python-sdk/">Python SDK</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/deployment/">Deployment</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/authentication/">Authentication</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors bg-primary/10 text-primary font-medium" style="padding-left:24px" href="/docs/guides/websocket-api/">WebSocket API</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/migrations/">Migrations</a><a class="block py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:24px" href="/docs/guides/troubleshooting/">Troubleshooting</a></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_r6av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Reference</button><div data-state="closed" id="radix-_R_r6av5ubtb_" hidden="" data-slot="collapsible-content"></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_136av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Specification</button><div data-state="closed" id="radix-_R_136av5ubtb_" hidden="" data-slot="collapsible-content"></div></div><div data-state="closed" data-slot="collapsible"><button class="w-full flex items-center w-full py-1.5 px-3 text-sm rounded-md transition-colors text-muted-foreground hover:bg-muted hover:text-foreground" style="padding-left:12px" type="button" aria-controls="radix-_R_1b6av5ubtb_" aria-expanded="false" data-state="closed" data-slot="collapsible-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-3.5 w-3.5 mr-1 shrink-0 transition-transform"><path d="m9 18 6-6-6-6"></path></svg>Internals</button><div data-state="closed" id="radix-_R_1b6av5ubtb_" hidden="" data-slot="collapsible-content"></div></div></nav></div></div><div class="flex flex-1 flex-col overflow-hidden"><div class="flex flex-1 overflow-hidden"><div class="flex-1 overflow-y-auto px-8 py-6 max-w-4xl mx-auto"><article class="docs-prose"><h1 id="websocket-api" node="[object Object]">WebSocket API</h1>
<p>The WebSocket API provides real-time, bidirectional communication with InputLayer. It supports authentication, query execution, streaming results, session rules, and push notifications.</p>
<h2 id="connection" node="[object Object]">Connection</h2>
<p>Connect to the global WebSocket endpoint:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">ws://host:port/ws
</code></pre>
<p>With TLS (via reverse proxy):</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">wss://host:port/ws
</code></pre>
<p>Optionally specify a knowledge graph via query parameter:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">ws://host:port/ws?kg=mydb
</code></pre>
<h2 id="authentication" node="[object Object]">Authentication</h2>
<p>The first message after connection must authenticate. There are two methods:</p>
<h3 id="usernamepassword" node="[object Object]">Username/Password</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"login"</span>,
  <span class="syn-identifier">"username"</span>: <span class="syn-string">"admin"</span>,
  <span class="syn-identifier">"password"</span>: <span class="syn-string">"admin"</span>
}</code></pre>
<h3 id="api-key" node="[object Object]">API Key</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"authenticate"</span>,
  <span class="syn-identifier">"api_key"</span>: <span class="syn-string">"your-api-key"</span>
}</code></pre>
<h3 id="auth-response" node="[object Object]">Auth Response</h3>
<p>On success:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"authenticated"</span>,
  <span class="syn-identifier">"session_id"</span>: <span class="syn-string">"a1b2c3d4"</span>,
  <span class="syn-identifier">"knowledge_graph"</span>: <span class="syn-string">"default"</span>,
  <span class="syn-identifier">"version"</span>: <span class="syn-string">"0.1.0"</span>,
  <span class="syn-identifier">"role"</span>: <span class="syn-string">"admin"</span>
}</code></pre>
<p>On failure:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"auth_error"</span>,
  <span class="syn-identifier">"message"</span>: <span class="syn-string">"Invalid credentials"</span>
}</code></pre>
<p>The server allows 30 seconds for authentication before closing the connection.</p>
<h2 id="executing-statements" node="[object Object]">Executing Statements</h2>
<p>Send any InputLayer statement or meta command:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"execute"</span>,
  <span class="syn-identifier">"program"</span>: <span class="syn-string">"?edge(X, Y)"</span>
}</code></pre>
<p>The <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">program</code> field accepts any valid InputLayer statement: queries, inserts, rule definitions, meta commands, etc.</p>
<h3 id="result-response" node="[object Object]">Result Response</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"result"</span>,
  <span class="syn-identifier">"columns"</span>: [<span class="syn-string">"X"</span>, <span class="syn-string">"Y"</span>],
  <span class="syn-identifier">"rows"</span>: [[<span class="syn-number">1</span>, <span class="syn-number">2</span>], [<span class="syn-number">2</span>, <span class="syn-number">3</span>], [<span class="syn-number">3</span>, <span class="syn-number">4</span>]],
  <span class="syn-identifier">"row_count"</span>: <span class="syn-number">3</span>,
  <span class="syn-identifier">"total_count"</span>: <span class="syn-number">3</span>,
  <span class="syn-identifier">"truncated"</span>: <span class="syn-keyword">false</span>,
  <span class="syn-identifier">"execution_time_ms"</span>: <span class="syn-number">2</span>
}</code></pre>
<h3 id="error-response" node="[object Object]">Error Response</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"error"</span>,
  <span class="syn-identifier">"message"</span>: <span class="syn-string">"Unknown relation 'edge'"</span>
}</code></pre>
<h2 id="knowledge-graph-operations" node="[object Object]">Knowledge Graph Operations</h2>
<p>Use meta commands via execute:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{<span class="syn-identifier">"type"</span>: <span class="syn-string">"execute"</span>, <span class="syn-identifier">"program"</span>: <span class="syn-string">".kg create mydb"</span>}
{<span class="syn-identifier">"type"</span>: <span class="syn-string">"execute"</span>, <span class="syn-identifier">"program"</span>: <span class="syn-string">".kg use mydb"</span>}
{<span class="syn-identifier">"type"</span>: <span class="syn-string">"execute"</span>, <span class="syn-identifier">"program"</span>: <span class="syn-string">".kg list"</span>}
{<span class="syn-identifier">"type"</span>: <span class="syn-string">"execute"</span>, <span class="syn-identifier">"program"</span>: <span class="syn-string">".kg drop mydb"</span>}</code></pre>
<p>When <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">.kg use</code> switches knowledge graphs, the result includes a <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">switched_kg</code> field.</p>
<h2 id="streaming-results" node="[object Object]">Streaming Results</h2>
<p>For large result sets (&gt; 1MB serialized), the server automatically streams results in chunks:</p>
<h3 id="stream-start" node="[object Object]">Stream Start</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"result_start"</span>,
  <span class="syn-identifier">"columns"</span>: [<span class="syn-string">"X"</span>, <span class="syn-string">"Y"</span>],
  <span class="syn-identifier">"total_count"</span>: <span class="syn-number">50000</span>,
  <span class="syn-identifier">"truncated"</span>: <span class="syn-keyword">false</span>,
  <span class="syn-identifier">"execution_time_ms"</span>: <span class="syn-number">245</span>
}</code></pre>
<h3 id="stream-chunk" node="[object Object]">Stream Chunk</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"result_chunk"</span>,
  <span class="syn-identifier">"rows"</span>: [[<span class="syn-number">1</span>, <span class="syn-number">2</span>], [<span class="syn-number">2</span>, <span class="syn-number">3</span>]],
  <span class="syn-identifier">"chunk_index"</span>: <span class="syn-number">0</span>
}</code></pre>
<p>Each chunk contains up to 500 rows. Chunks are sent sequentially.</p>
<h3 id="stream-end" node="[object Object]">Stream End</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"result_end"</span>,
  <span class="syn-identifier">"row_count"</span>: <span class="syn-number">50000</span>,
  <span class="syn-identifier">"chunk_count"</span>: <span class="syn-number">100</span>
}</code></pre>
<p>Small results (&lt; 1MB) use the single <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">result</code> message, maintaining backward compatibility.</p>
<h2 id="session-rules" node="[object Object]">Session Rules</h2>
<p>Session rules are ephemeral rules scoped to the current WebSocket connection. They are automatically cleared when the connection closes.</p>
<h3 id="define-session-rule" node="[object Object]">Define Session Rule</h3>
<p>Session rules omit the <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">+</code> prefix:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"execute"</span>,
  <span class="syn-identifier">"program"</span>: <span class="syn-string">"temp(X, Y) &lt;- edge(X, Y), X &lt; Y"</span>
}</code></pre>
<h3 id="session-facts" node="[object Object]">Session Facts</h3>
<p>Insert transient facts scoped to the session:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"execute"</span>,
  <span class="syn-identifier">"program"</span>: <span class="syn-string">"context(\"user\", \"alice\")"</span>
}</code></pre>
<h3 id="query-with-session-rules" node="[object Object]">Query with Session Rules</h3>
<p>Session rules are automatically included when querying:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"execute"</span>,
  <span class="syn-identifier">"program"</span>: <span class="syn-string">"?temp(X, Y)"</span>
}</code></pre>
<h3 id="clear-session" node="[object Object]">Clear Session</h3>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"execute"</span>,
  <span class="syn-identifier">"program"</span>: <span class="syn-string">".session clear"</span>
}</code></pre>
<h2 id="notifications" node="[object Object]">Notifications</h2>
<p>The server pushes notifications when persistent data changes in the session&#x27;s knowledge graph.</p>
<h3 id="persistent-update" node="[object Object]">Persistent Update</h3>
<p>Sent when base facts in a relation change:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"persistent_update"</span>,
  <span class="syn-identifier">"knowledge_graph"</span>: <span class="syn-string">"default"</span>,
  <span class="syn-identifier">"relation"</span>: <span class="syn-string">"edge"</span>,
  <span class="syn-identifier">"operation"</span>: <span class="syn-string">"insert"</span>,
  <span class="syn-identifier">"count"</span>: <span class="syn-number">5</span>,
  <span class="syn-identifier">"timestamp_ms"</span>: <span class="syn-number">1700000000000</span>,
  <span class="syn-identifier">"seq"</span>: <span class="syn-number">42</span>
}</code></pre>
<h3 id="rule-change" node="[object Object]">Rule Change</h3>
<p>Sent when a rule is registered, removed, or dropped:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"rule_change"</span>,
  <span class="syn-identifier">"knowledge_graph"</span>: <span class="syn-string">"default"</span>,
  <span class="syn-identifier">"rule_name"</span>: <span class="syn-string">"reachable"</span>,
  <span class="syn-identifier">"operation"</span>: <span class="syn-string">"registered"</span>,
  <span class="syn-identifier">"timestamp_ms"</span>: <span class="syn-number">1700000000000</span>,
  <span class="syn-identifier">"seq"</span>: <span class="syn-number">43</span>
}</code></pre>
<h3 id="kg-change" node="[object Object]">KG Change</h3>
<p>Sent when a knowledge graph is created or dropped:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"kg_change"</span>,
  <span class="syn-identifier">"knowledge_graph"</span>: <span class="syn-string">"mydb"</span>,
  <span class="syn-identifier">"operation"</span>: <span class="syn-string">"created"</span>,
  <span class="syn-identifier">"timestamp_ms"</span>: <span class="syn-number">1700000000000</span>,
  <span class="syn-identifier">"seq"</span>: <span class="syn-number">44</span>
}</code></pre>
<h3 id="schema-change" node="[object Object]">Schema Change</h3>
<p>Sent when a relation is dropped:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"schema_change"</span>,
  <span class="syn-identifier">"knowledge_graph"</span>: <span class="syn-string">"default"</span>,
  <span class="syn-identifier">"entity"</span>: <span class="syn-string">"edge"</span>,
  <span class="syn-identifier">"operation"</span>: <span class="syn-string">"dropped"</span>,
  <span class="syn-identifier">"timestamp_ms"</span>: <span class="syn-number">1700000000000</span>,
  <span class="syn-identifier">"seq"</span>: <span class="syn-number">45</span>
}</code></pre>
<p>The <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">seq</code> field is a monotonic sequence number for deduplication on reconnect.</p>
<h2 id="keep-alive" node="[object Object]">Keep-Alive</h2>
<p>Send a ping to keep the connection alive:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{<span class="syn-identifier">"type"</span>: <span class="syn-string">"ping"</span>}</code></pre>
<p>Response:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{<span class="syn-identifier">"type"</span>: <span class="syn-string">"pong"</span>}</code></pre>
<p>The server also sends WebSocket-level pings every 30 seconds to detect dead connections.</p>
<h2 id="connection-lifecycle" node="[object Object]">Connection Lifecycle</h2>
<ol>
<li><strong>Connect</strong> to <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">ws://host:port/ws</code></li>
<li><strong>Authenticate</strong> with <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">login</code> or <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">authenticate</code></li>
<li><strong>Execute</strong> statements and queries</li>
<li><strong>Receive</strong> notifications for data changes</li>
<li><strong>Close</strong> gracefully by sending a WebSocket Close frame</li>
</ol>
<h3 id="graceful-close" node="[object Object]">Graceful Close</h3>
<p>Always send a Close frame before disconnecting to avoid server warnings:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-python text-sm"><span class="syn-comment"># Python</span>
<span class="syn-keyword">await</span> websocket.close()</code></pre>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-javascript text-sm"><span class="syn-comment">// JavaScript</span>
ws.close(<span class="syn-number">1000</span>, <span class="syn-string">"Normal closure"</span>);</code></pre>
<h2 id="reconnection" node="[object Object]">Reconnection</h2>
<p>If the connection drops:</p>
<ol>
<li>Wait with exponential backoff (1s, 2s, 4s, 8s, max 30s)</li>
<li>Reconnect and re-authenticate</li>
<li>Session rules and facts are lost — re-define them after reconnecting</li>
<li>Persistent data (facts, rules, indexes) is unaffected</li>
<li>Use the <code class="bg-muted rounded px-1.5 py-0.5 font-mono text-sm" node="[object Object]">seq</code> field from notifications to detect missed events</li>
</ol>
<h2 id="rate-limiting" node="[object Object]">Rate Limiting</h2>
<p>The server applies per-connection rate limiting (default: 1000 messages/sec, configurable). Exceeding the limit returns:</p>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-json text-sm">{
  <span class="syn-identifier">"type"</span>: <span class="syn-string">"error"</span>,
  <span class="syn-identifier">"message"</span>: <span class="syn-string">"Rate limit exceeded (1000 msgs/sec)"</span>
}</code></pre>
<h2 id="example-python-client" node="[object Object]">Example: Python Client</h2>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-python text-sm">



<span class="syn-keyword">async</span> <span class="syn-keyword">def</span> main():
    <span class="syn-keyword">async</span> <span class="syn-keyword">with</span> websockets.connect(<span class="syn-string">"ws://localhost:8080/ws"</span>) <span class="syn-keyword">as</span> ws:
        <span class="syn-comment"># Authenticate</span>
        <span class="syn-keyword">await</span> ws.send(json.dumps({
            <span class="syn-string">"type"</span>: <span class="syn-string">"login"</span>,
            <span class="syn-string">"username"</span>: <span class="syn-string">"admin"</span>,
            <span class="syn-string">"password"</span>: <span class="syn-string">"admin"</span>
        }))
        auth_resp = json.loads(<span class="syn-keyword">await</span> ws.recv())
        <span class="syn-keyword">assert</span> auth_resp[<span class="syn-string">"type"</span>] == <span class="syn-string">"authenticated"</span>
        <span class="syn-builtin">print</span>(<span class="syn-string">f"Session: {auth_resp['session_id']}"</span>)

        <span class="syn-comment"># Insert data</span>
        <span class="syn-keyword">await</span> ws.send(json.dumps({
            <span class="syn-string">"type"</span>: <span class="syn-string">"execute"</span>,
            <span class="syn-string">"program"</span>: <span class="syn-string">"+edge[(1, 2), (2, 3), (3, 4)]"</span>
        }))
        result = json.loads(<span class="syn-keyword">await</span> ws.recv())

        <span class="syn-comment"># Query</span>
        <span class="syn-keyword">await</span> ws.send(json.dumps({
            <span class="syn-string">"type"</span>: <span class="syn-string">"execute"</span>,
            <span class="syn-string">"program"</span>: <span class="syn-string">"?edge(X, Y)"</span>
        }))
        result = json.loads(<span class="syn-keyword">await</span> ws.recv())
        <span class="syn-builtin">print</span>(<span class="syn-string">f"Got {result['row_count']} rows"</span>)

        <span class="syn-comment"># Close gracefully</span>
        <span class="syn-keyword">await</span> ws.close()

asyncio.run(main())</code></pre>
<h2 id="example-javascript-client" node="[object Object]">Example: JavaScript Client</h2>
<pre class="rounded-lg bg-[var(--code-bg)] p-4 overflow-x-auto mb-4 text-sm font-mono" node="[object Object]"><code class="language-javascript text-sm"><span class="syn-keyword">const</span> ws = <span class="syn-keyword">new</span> WebSocket(<span class="syn-string">"ws://localhost:8080/ws"</span>);

ws.onopen = () <span class="syn-arrow">=&gt;</span> {
  ws.send(<span class="syn-builtin">JSON</span>.stringify({
    type: <span class="syn-string">"login"</span>,
    username: <span class="syn-string">"admin"</span>,
    password: <span class="syn-string">"admin"</span>
  }));
};

ws.onmessage = (event) <span class="syn-arrow">=&gt;</span> {
  <span class="syn-keyword">const</span> msg = <span class="syn-builtin">JSON</span>.parse(event.data);

  <span class="syn-keyword">if</span> (msg.type === <span class="syn-string">"authenticated"</span>) {
    <span class="syn-comment">// Authenticated — start querying</span>
    ws.send(<span class="syn-builtin">JSON</span>.stringify({
      type: <span class="syn-string">"execute"</span>,
      program: <span class="syn-string">"?edge(X, Y)"</span>
    }));
  }

  <span class="syn-keyword">if</span> (msg.type === <span class="syn-string">"result"</span>) {
    <span class="syn-builtin">console</span>.log(<span class="syn-string">`Query returned ${msg.row_count} rows`</span>);
  }

  <span class="syn-comment">// Handle streaming results</span>
  <span class="syn-keyword">if</span> (msg.type === <span class="syn-string">"result_start"</span>) {
    <span class="syn-builtin">console</span>.log(<span class="syn-string">`Streaming ${msg.total_count} rows...`</span>);
  }
  <span class="syn-keyword">if</span> (msg.type === <span class="syn-string">"result_chunk"</span>) {
    <span class="syn-builtin">console</span>.log(<span class="syn-string">`Received chunk ${msg.chunk_index}`</span>);
  }
  <span class="syn-keyword">if</span> (msg.type === <span class="syn-string">"result_end"</span>) {
    <span class="syn-builtin">console</span>.log(<span class="syn-string">`Stream complete: ${msg.row_count} rows`</span>);
  }

  <span class="syn-comment">// Handle notifications</span>
  <span class="syn-keyword">if</span> (msg.type === <span class="syn-string">"persistent_update"</span>) {
    <span class="syn-builtin">console</span>.log(<span class="syn-string">`${msg.relation}: ${msg.operation} ${msg.count} rows`</span>);
  }
};</code></pre></article></div><div class="hidden lg:block w-48 shrink-0 border-l border-border/50"><div class="sticky top-0 p-4"><p class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3">On this page</p><nav class="space-y-1"><a href="#connection" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Connection</a><a href="#authentication" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Authentication</a><a href="#usernamepassword" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Username/Password</a><a href="#api-key" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">API Key</a><a href="#auth-response" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Auth Response</a><a href="#executing-statements" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Executing Statements</a><a href="#result-response" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Result Response</a><a href="#error-response" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Error Response</a><a href="#knowledge-graph-operations" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Knowledge Graph Operations</a><a href="#streaming-results" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Streaming Results</a><a href="#stream-start" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Stream Start</a><a href="#stream-chunk" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Stream Chunk</a><a href="#stream-end" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Stream End</a><a href="#session-rules" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Session Rules</a><a href="#define-session-rule" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Define Session Rule</a><a href="#session-facts" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Session Facts</a><a href="#query-with-session-rules" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Query with Session Rules</a><a href="#clear-session" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Clear Session</a><a href="#notifications" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Notifications</a><a href="#persistent-update" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Persistent Update</a><a href="#rule-change" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Rule Change</a><a href="#kg-change" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">KG Change</a><a href="#schema-change" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Schema Change</a><a href="#keep-alive" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Keep-Alive</a><a href="#connection-lifecycle" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Connection Lifecycle</a><a href="#graceful-close" class="block text-xs py-0.5 transition-colors hover:text-foreground pl-3 text-muted-foreground">Graceful Close</a><a href="#reconnection" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Reconnection</a><a href="#rate-limiting" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Rate Limiting</a><a href="#example-python-client" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Example: Python Client</a><a href="#example-javascript-client" class="block text-xs py-0.5 transition-colors hover:text-foreground text-muted-foreground">Example: JavaScript Client</a></nav></div></div></div></div></div></div><!--$--><!--/$--><script src="/_next/static/chunks/webpack-bd6546b43ab2ecbf.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1942,[\"177\",\"static/chunks/app/layout-7e9963bf811be36b.js\"],\"ThemeProvider\"]\n3:I[7121,[],\"\"]\n4:I[4581,[],\"\"]\n6:I[484,[],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[484,[],\"ViewportBoundary\"]\nb:I[484,[],\"MetadataBoundary\"]\nd:I[7123,[],\"\"]\n:HL[\"/_next/static/media/4cf2300e9c8272f7-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/4bd7a24b7976d4e6.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"05bjYGyiAumoEMBrfWHih\",\"c\":[\"\",\"docs\",\"guides\",\"websocket-api\",\"\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"guides/websocket-api\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4bd7a24b7976d4e6.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_188709 __variable_9a8899 font-sans antialiased\",\"children\":[\"$\",\"$L2\",null,{\"attribute\":\"class\",\"defaultTheme\":\"dark\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:I[8428,[\"758\",\"static/chunks/758-3cb69ce377cde046.js\",\"121\",\"static/chunks/121-aece4f809b101dc1.js\",\"502\",\"static/chunks/502-e809071f8789437b.js\",\"689\",\"static/chunks/689-4fcf9680fdc90283.js\",\"870\",\"static/chunks/app/docs/%5B%5B...slug%5D%5D/page-004ec69e3c86920a.js\"],\"DocsPageClient\"]\nf:T1de1,"])</script><script>self.__next_f.push([1,"# WebSocket API\n\nThe WebSocket API provides real-time, bidirectional communication with InputLayer. It supports authentication, query execution, streaming results, session rules, and push notifications.\n\n## Connection\n\nConnect to the global WebSocket endpoint:\n\n```\nws://host:port/ws\n```\n\nWith TLS (via reverse proxy):\n\n```\nwss://host:port/ws\n```\n\nOptionally specify a knowledge graph via query parameter:\n\n```\nws://host:port/ws?kg=mydb\n```\n\n## Authentication\n\nThe first message after connection must authenticate. There are two methods:\n\n### Username/Password\n\n```json\n{\n  \"type\": \"login\",\n  \"username\": \"admin\",\n  \"password\": \"admin\"\n}\n```\n\n### API Key\n\n```json\n{\n  \"type\": \"authenticate\",\n  \"api_key\": \"your-api-key\"\n}\n```\n\n### Auth Response\n\nOn success:\n\n```json\n{\n  \"type\": \"authenticated\",\n  \"session_id\": \"a1b2c3d4\",\n  \"knowledge_graph\": \"default\",\n  \"version\": \"0.1.0\",\n  \"role\": \"admin\"\n}\n```\n\nOn failure:\n\n```json\n{\n  \"type\": \"auth_error\",\n  \"message\": \"Invalid credentials\"\n}\n```\n\nThe server allows 30 seconds for authentication before closing the connection.\n\n## Executing Statements\n\nSend any InputLayer statement or meta command:\n\n```json\n{\n  \"type\": \"execute\",\n  \"program\": \"?edge(X, Y)\"\n}\n```\n\nThe `program` field accepts any valid InputLayer statement: queries, inserts, rule definitions, meta commands, etc.\n\n### Result Response\n\n```json\n{\n  \"type\": \"result\",\n  \"columns\": [\"X\", \"Y\"],\n  \"rows\": [[1, 2], [2, 3], [3, 4]],\n  \"row_count\": 3,\n  \"total_count\": 3,\n  \"truncated\": false,\n  \"execution_time_ms\": 2\n}\n```\n\n### Error Response\n\n```json\n{\n  \"type\": \"error\",\n  \"message\": \"Unknown relation 'edge'\"\n}\n```\n\n## Knowledge Graph Operations\n\nUse meta commands via execute:\n\n```json\n{\"type\": \"execute\", \"program\": \".kg create mydb\"}\n{\"type\": \"execute\", \"program\": \".kg use mydb\"}\n{\"type\": \"execute\", \"program\": \".kg list\"}\n{\"type\": \"execute\", \"program\": \".kg drop mydb\"}\n```\n\nWhen `.kg use` switches knowledge graphs, the result includes a `switched_kg` field.\n\n## Streaming Results\n\nFor large result sets (\u003e 1MB serialized), the server automatically streams results in chunks:\n\n### Stream Start\n\n```json\n{\n  \"type\": \"result_start\",\n  \"columns\": [\"X\", \"Y\"],\n  \"total_count\": 50000,\n  \"truncated\": false,\n  \"execution_time_ms\": 245\n}\n```\n\n### Stream Chunk\n\n```json\n{\n  \"type\": \"result_chunk\",\n  \"rows\": [[1, 2], [2, 3]],\n  \"chunk_index\": 0\n}\n```\n\nEach chunk contains up to 500 rows. Chunks are sent sequentially.\n\n### Stream End\n\n```json\n{\n  \"type\": \"result_end\",\n  \"row_count\": 50000,\n  \"chunk_count\": 100\n}\n```\n\nSmall results (\u003c 1MB) use the single `result` message, maintaining backward compatibility.\n\n## Session Rules\n\nSession rules are ephemeral rules scoped to the current WebSocket connection. They are automatically cleared when the connection closes.\n\n### Define Session Rule\n\nSession rules omit the `+` prefix:\n\n```json\n{\n  \"type\": \"execute\",\n  \"program\": \"temp(X, Y) \u003c- edge(X, Y), X \u003c Y\"\n}\n```\n\n### Session Facts\n\nInsert transient facts scoped to the session:\n\n```json\n{\n  \"type\": \"execute\",\n  \"program\": \"context(\\\"user\\\", \\\"alice\\\")\"\n}\n```\n\n### Query with Session Rules\n\nSession rules are automatically included when querying:\n\n```json\n{\n  \"type\": \"execute\",\n  \"program\": \"?temp(X, Y)\"\n}\n```\n\n### Clear Session\n\n```json\n{\n  \"type\": \"execute\",\n  \"program\": \".session clear\"\n}\n```\n\n## Notifications\n\nThe server pushes notifications when persistent data changes in the session's knowledge graph.\n\n### Persistent Update\n\nSent when base facts in a relation change:\n\n```json\n{\n  \"type\": \"persistent_update\",\n  \"knowledge_graph\": \"default\",\n  \"relation\": \"edge\",\n  \"operation\": \"insert\",\n  \"count\": 5,\n  \"timestamp_ms\": 1700000000000,\n  \"seq\": 42\n}\n```\n\n### Rule Change\n\nSent when a rule is registered, removed, or dropped:\n\n```json\n{\n  \"type\": \"rule_change\",\n  \"knowledge_graph\": \"default\",\n  \"rule_name\": \"reachable\",\n  \"operation\": \"registered\",\n  \"timestamp_ms\": 1700000000000,\n  \"seq\": 43\n}\n```\n\n### KG Change\n\nSent when a knowledge graph is created or dropped:\n\n```json\n{\n  \"type\": \"kg_change\",\n  \"knowledge_graph\": \"mydb\",\n  \"operation\": \"created\",\n  \"timestamp_ms\": 1700000000000,\n  \"seq\": 44\n}\n```\n\n### Schema Change\n\nSent when a relation is dropped:\n\n```json\n{\n  \"type\": \"schema_change\",\n  \"knowledge_graph\": \"default\",\n  \"entity\": \"edge\",\n  \"operation\": \"dropped\",\n  \"timestamp_ms\": 1700000000000,\n  \"seq\": 45\n}\n```\n\nThe `seq` field is a monotonic sequence number for deduplication on reconnect.\n\n## Keep-Alive\n\nSend a ping to keep the connection alive:\n\n```json\n{\"type\": \"ping\"}\n```\n\nResponse:\n\n```json\n{\"type\": \"pong\"}\n```\n\nThe server also sends WebSocket-level pings every 30 seconds to detect dead connections.\n\n## Connection Lifecycle\n\n1. **Connect** to `ws://host:port/ws`\n2. **Authenticate** with `login` or `authenticate`\n3. **Execute** statements and queries\n4. **Receive** notifications for data changes\n5. **Close** gracefully by sending a WebSocket Close frame\n\n### Graceful Close\n\nAlways send a Close frame before disconnecting to avoid server warnings:\n\n```python\n# Python\nawait websocket.close()\n```\n\n```javascript\n// JavaScript\nws.close(1000, \"Normal closure\");\n```\n\n## Reconnection\n\nIf the connection drops:\n\n1. Wait with exponential backoff (1s, 2s, 4s, 8s, max 30s)\n2. Reconnect and re-authenticate\n3. Session rules and facts are lost — re-define them after reconnecting\n4. Persistent data (facts, rules, indexes) is unaffected\n5. Use the `seq` field from notifications to detect missed events\n\n## Rate Limiting\n\nThe server applies per-connection rate limiting (default: 1000 messages/sec, configurable). Exceeding the limit returns:\n\n```json\n{\n  \"type\": \"error\",\n  \"message\": \"Rate limit exceeded (1000 msgs/sec)\"\n}\n```\n\n## Example: Python Client\n\n```python\n\n\n\n\nasync def main():\n    async with websockets.connect(\"ws://localhost:8080/ws\") as ws:\n        # Authenticate\n        await ws.send(json.dumps({\n            \"type\": \"login\",\n            \"username\": \"admin\",\n            \"password\": \"admin\"\n        }))\n        auth_resp = json.loads(await ws.recv())\n        assert auth_resp[\"type\"] == \"authenticated\"\n        print(f\"Session: {auth_resp['session_id']}\")\n\n        # Insert data\n        await ws.send(json.dumps({\n            \"type\": \"execute\",\n            \"program\": \"+edge[(1, 2), (2, 3), (3, 4)]\"\n        }))\n        result = json.loads(await ws.recv())\n\n        # Query\n        await ws.send(json.dumps({\n            \"type\": \"execute\",\n            \"program\": \"?edge(X, Y)\"\n        }))\n        result = json.loads(await ws.recv())\n        print(f\"Got {result['row_count']} rows\")\n\n        # Close gracefully\n        await ws.close()\n\nasyncio.run(main())\n```\n\n## Example: JavaScript Client\n\n```javascript\nconst ws = new WebSocket(\"ws://localhost:8080/ws\");\n\nws.onopen = () =\u003e {\n  ws.send(JSON.stringify({\n    type: \"login\",\n    username: \"admin\",\n    password: \"admin\"\n  }));\n};\n\nws.onmessage = (event) =\u003e {\n  const msg = JSON.parse(event.data);\n\n  if (msg.type === \"authenticated\") {\n    // Authenticated — start querying\n    ws.send(JSON.stringify({\n      type: \"execute\",\n      program: \"?edge(X, Y)\"\n    }));\n  }\n\n  if (msg.type === \"result\") {\n    console.log(`Query returned ${msg.row_count} rows`);\n  }\n\n  // Handle streaming results\n  if (msg.type === \"result_start\") {\n    console.log(`Streaming ${msg.total_count} rows...`);\n  }\n  if (msg.type === \"result_chunk\") {\n    console.log(`Received chunk ${msg.chunk_index}`);\n  }\n  if (msg.type === \"result_end\") {\n    console.log(`Stream complete: ${msg.row_count} rows`);\n  }\n\n  // Handle notifications\n  if (msg.type === \"persistent_update\") {\n    console.log(`${msg.relation}: ${msg.operation} ${msg.count} rows`);\n  }\n};\n```"])</script><script>self.__next_f.push([1,"5:[\"$\",\"$Le\",null,{\"page\":{\"title\":\"WebSocket API\",\"content\":\"$f\",\"toc\":[{\"level\":2,\"text\":\"Connection\",\"id\":\"connection\"},{\"level\":2,\"text\":\"Authentication\",\"id\":\"authentication\"},{\"level\":3,\"text\":\"Username/Password\",\"id\":\"usernamepassword\"},{\"level\":3,\"text\":\"API Key\",\"id\":\"api-key\"},{\"level\":3,\"text\":\"Auth Response\",\"id\":\"auth-response\"},{\"level\":2,\"text\":\"Executing Statements\",\"id\":\"executing-statements\"},{\"level\":3,\"text\":\"Result Response\",\"id\":\"result-response\"},{\"level\":3,\"text\":\"Error Response\",\"id\":\"error-response\"},{\"level\":2,\"text\":\"Knowledge Graph Operations\",\"id\":\"knowledge-graph-operations\"},{\"level\":2,\"text\":\"Streaming Results\",\"id\":\"streaming-results\"},{\"level\":3,\"text\":\"Stream Start\",\"id\":\"stream-start\"},{\"level\":3,\"text\":\"Stream Chunk\",\"id\":\"stream-chunk\"},{\"level\":3,\"text\":\"Stream End\",\"id\":\"stream-end\"},{\"level\":2,\"text\":\"Session Rules\",\"id\":\"session-rules\"},{\"level\":3,\"text\":\"Define Session Rule\",\"id\":\"define-session-rule\"},{\"level\":3,\"text\":\"Session Facts\",\"id\":\"session-facts\"},{\"level\":3,\"text\":\"Query with Session Rules\",\"id\":\"query-with-session-rules\"},{\"level\":3,\"text\":\"Clear Session\",\"id\":\"clear-session\"},{\"level\":2,\"text\":\"Notifications\",\"id\":\"notifications\"},{\"level\":3,\"text\":\"Persistent Update\",\"id\":\"persistent-update\"},{\"level\":3,\"text\":\"Rule Change\",\"id\":\"rule-change\"},{\"level\":3,\"text\":\"KG Change\",\"id\":\"kg-change\"},{\"level\":3,\"text\":\"Schema Change\",\"id\":\"schema-change\"},{\"level\":2,\"text\":\"Keep-Alive\",\"id\":\"keep-alive\"},{\"level\":2,\"text\":\"Connection Lifecycle\",\"id\":\"connection-lifecycle\"},{\"level\":3,\"text\":\"Graceful Close\",\"id\":\"graceful-close\"},{\"level\":2,\"text\":\"Reconnection\",\"id\":\"reconnection\"},{\"level\":2,\"text\":\"Rate Limiting\",\"id\":\"rate-limiting\"},{\"level\":2,\"text\":\"Example: Python Client\",\"id\":\"example-python-client\"},{\"level\":2,\"text\":\"Example: JavaScript Client\",\"id\":\"example-javascript-client\"}]},\"slugKey\":\"guides/websocket-api\"}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"10:I[6869,[],\"IconMark\"]\nc:[[\"$\",\"title\",\"0\",{\"children\":\"InputLayer - A symbolic reasoning engine for AI agents\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Store facts, define rules, and derive everything that logically follows. Vector search, graph traversal, and incremental computation in one system.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/icon.svg\"}],[\"$\",\"$L10\",\"3\",{}]]\n8:null\n"])</script></body></html>